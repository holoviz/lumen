{% extends 'BaseViewAgent/main.jinja2' %}

{% block instructions %}
Generate a complete, polished Vega-Lite visualization with strategic color and compelling narrative titles.

# CORE REQUIREMENTS
- Use `data: {name: {{ memory['table'] }}}` - never invent data
- Use exact column names from source
- ALWAYS use layer structure - wrap your visualization in a layer array
- Each layer has its own `mark` and `encoding`
- Properties like `opacity` go inside mark: `mark: {type: bar, opacity: 0.75}`
- Basic transforms if needed (fold, calculate, etc.)

# SORTING FOR RANKINGS
For bar charts, sort by quantitative values to show rankings:
- Horizontal: `y: {field: category, type: ordinal, sort: "-x"}`
- Vertical: `x: {field: category, type: ordinal, sort: "-y"}`

# DATA TYPES
- Year ints/floats: type=quantitative if length>10, else ordinal
- Date strings: type=temporal with timeUnit
- Combine date fields: `calculate: datetime(datum.Year, datum.Month-1)`

# COLOR STRATEGY
Color is pre-attentive - use it intentionally to guide attention, not arbitrarily.

Use conditional color to highlight:
- Leaders/outliers in comparisons (top state, best product)
- Meaningful thresholds (goals, benchmarks, policy changes)
- Time periods that match your subtitle ("after 2020" â†’ highlight post-2020)

Color palette:
- Highlight color: '#c0392b' (dark red) for emphasis
- Neutral/de-emphasized: '#bdc3c7' (light gray)
- Success/positive: '#27ae60' (green)
- Primary: '#3498db' (blue)

# NARRATIVE TITLES
Create compelling chart titles that communicate key insights:
- Add a descriptive main title that summarizes what the chart shows
- Include a subtitle that highlights the key finding or insight from the data
- Use proper title formatting with fontSize, anchor, and subtitle styling
- Titles should be specific to the data, not generic descriptions

Examples of narrative titles:
```yaml
title:
  anchor: start
  fontSize: 20
  subtitle: "Key insight about the data trend or pattern"
  subtitleColor: '#666666'
  subtitleFontSize: 16
  text: "Descriptive title about what the chart shows"
```
{% endblock %}

{% block examples %}
{% if doc_examples is defined and doc_examples %}
## Below are examples from documentation
{% for example in doc_examples %}
```yaml
{{ example }}
```
{% endfor %}
{% endif %}

Simple time series:
```yaml
title:
  anchor: start
  fontSize: 20
  subtitle: "Steady growth trend from 2010 to 2024"
  subtitleColor: '#666666'
  subtitleFontSize: 16
  text: "Wind Turbine Capacity Over Time"
data:
  name: <TABLE_NAME>
layer:
  - mark:
      type: line
      point: true
      color: <color>
    encoding:
      x: {field: year, type: quantitative}
      y: {field: avg_capacity, type: quantitative}
```
{% endblock %}

{% block errors %}
{{ super() }}

{% if errors is defined and errors %}
For extra context, here are the data and columns available:
{{ columns_context }}
{% endif %}
{% endblock %}

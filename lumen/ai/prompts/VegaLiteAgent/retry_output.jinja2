{% extends 'LumenBaseAgent/retry_output.jinja2' %}

{% block context %}
{{ super() }}

{% if step_name is defined %}
Fixing {{ step_name }} step. Current spec:
```yaml
{{ current_spec }}
```

Step focus:
- axes: axis formatting, titles, labels, sorting
- labels: colors, tooltips, conditional formatting
- polish: chart titles, styling, config
{% endif %}
{% endblock %}

{% block instructions %}
{{ super() }}

- For overlays: data at top level, encoding in layer
- Ensure YAML is valid and mergeable
- Return only the corrected update portion
{% endblock %}

{%- block examples -%}
# EXAMPLES
{% if doc_examples is defined and doc_examples %}
{% for example in doc_examples %}
{{ example }}
{% endfor %}
{% endif %}

Overlays:
```{{ language }}
spec:
  data:
    name: <TABLE_NAME>
  layer:
    - encoding:
      # main data
    - data:
      # other data
```
{%- endblock -%}

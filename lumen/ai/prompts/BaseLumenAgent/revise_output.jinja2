{% extends 'Agent/main.jinja2' %}

{% block instructions %}
Fix issues in the code based on user feedback using search/replace patterns.

Each edit must:
- Specify `old_str`: the exact text to find
- Specify `new_str`: the replacement text (or empty string to delete)

Critical Requirements:
- `old_str` must be COPIED EXACTLY from the document belowâ€”never reconstruct from memory
- `old_str` must appear EXACTLY ONCE in the document
- Include enough context to make `old_str` unique
- Preserve exact whitespace and indentation
- Only modify parts that need changing per feedback
- Focus on specific problems mentioned
- Do NOT add comments/code unless requested
- Use actual dataset columns, don't guess names

Provide separate search/replace operations as a list of edits.
{% endblock %}

{%- block context %}
{% if memory.get("data") %}
Data summary:
{{ memory['data'] }}
{% endif %}

{% if language %}
Language: {{ language }}
{% endif %}

Restate feedback:
{{ feedback }}

Here is the CURRENT DOCUMENT to modify. Copy `old_str` content EXACTLY from this document (preserve all whitespace and indentation):
```{% if language %}{{ language }}{% endif %}
{{ spec }}
```
{% endblock %}

{%- block examples -%}
# SEARCH/REPLACE EXAMPLES

## Insert New Content
Include surrounding lines as anchors in BOTH old_str and new_str:
```
old_str: |
  line_before
  line_after
new_str: |
  line_before
  new_content_here
  line_after
```

## Modify Nested Content
Match EXACT indentation. Use anchor lines:
```
old_str: |
      nested_property: old_value
      another: keep_this
    parent_end:
new_str: |
      nested_property: new_value
      another: keep_this
    parent_end:
```

## Delete Lines
Omit unwanted lines from new_str:
```
old_str: |
  keep_this
  delete_this: unwanted
  also_keep
new_str: |
  keep_this
  also_keep
```
{%- endblock -%}

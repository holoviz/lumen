
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Open-source agent framework for chatting with data and building dashboards">
      
      
        <meta name="author" content="HoloViz Developers">
      
      
        <link rel="canonical" href="https://lumen.holoviz.org/examples/tutorials/census_data_ai_explorer/">
      
      
        <link rel="prev" href="../saas_company_report_dashboard/">
      
      
        <link rel="next" href="../../gallery/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/favicon.ico">
      <meta name="generator" content="zensical-0.0.16">
    
    
      
        <title>Building a Census Data AI Explorer - Lumen</title>
      
    
    
      
        
      
      <link rel="stylesheet" href="../../../assets/stylesheets/modern/main.dfcb43b2.min.css">
      
        
          
        
        <link rel="stylesheet" href="../../../assets/stylesheets/modern/palette.dfe2e883.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,500,500i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,t)=>(e<<5)-e+t.charCodeAt(0)),0),__md_get=(e,t=localStorage,a=__md_scope)=>JSON.parse(t.getItem(a.pathname+"."+e)),__md_set=(e,t,a=localStorage,_=__md_scope)=>{try{a.setItem(_.pathname+"."+e,JSON.stringify(t))}catch(e){}},document.documentElement.setAttribute("data-platform",navigator.platform)</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#building-a-census-data-ai-explorer" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Lumen" class="md-header__button md-logo" aria-label="Lumen" data-md-component="logo">
      
  <img src="../../../assets/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-menu" viewBox="0 0 24 24"><path d="M4 5h16M4 12h16M4 19h16"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Lumen
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Building a Census Data AI Explorer
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="black"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-search" viewBox="0 0 24 24"><path d="m21 21-4.34-4.34"/><circle cx="11" cy="11" r="8"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog" aria-label="Search">
  <button type="button" class="md-search__button">
    Search
  </button>
</div>
      
    
    <div class="md-header__source">
      
        <a href="https://github.com/holoviz/lumen" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    holoviz/lumen
  </div>
</a>
      
    </div>
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Lumen" class="md-nav__button md-logo" aria-label="Lumen" data-md-component="logo">
      
  <img src="../../../assets/logo.svg" alt="logo">

    </a>
    Lumen
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/holoviz/lumen" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    holoviz/lumen
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../quick_start/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FAQ
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/launching_lumen/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Launching Lumen
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/navigating_the_ui/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Navigating the UI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/using_lumen_ai/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Using Lumen AI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Examples
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Examples
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Tutorials
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tutorials
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../weather_data_ai_explorer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Weather Data AI Explorer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../saas_company_report_dashboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SaaS Company Report Dashboard
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Census Data AI Explorer
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Census Data AI Explorer
  

    
  </span>
  
  

      </a>
      
        


<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#final-result" class="md-nav__link">
    <span class="md-ellipsis">
      
        Final result
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-youll-build" class="md-nav__link">
    <span class="md-ellipsis">
      
        What you'll build
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-custom-data-source-controls" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why custom data source controls?
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prerequisites
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-minimal-runnable-example" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Minimal runnable example
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-understanding-the-components" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Understanding the components
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Understanding the components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#custom-controls" class="md-nav__link">
    <span class="md-ellipsis">
      
        Custom controls
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ui-components" class="md-nav__link">
    <span class="md-ellipsis">
      
        UI components
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-fetching" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data fetching
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#duckdb-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        DuckDB integration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-extend-to-full-version" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Extend to full version
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#full-example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Full example
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Next steps
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-also" class="md-nav__link">
    <span class="md-ellipsis">
      
        See also
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../gallery/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Gallery
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Gallery
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gallery/penguins/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Penguins
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gallery/bikes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    London Bike Points
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gallery/seattle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Seattle Weather
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gallery/nyc_taxi/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    NYC Taxi
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gallery/precip/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Precipitation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gallery/earthquakes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Earthquakes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gallery/windturbines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Wind Turbines
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Configuration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configuration/cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CLI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configuration/prompts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Prompts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configuration/sources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Sources
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configuration/llm_providers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LLM Providers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configuration/analyses/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Analyses
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configuration/ui/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    UI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configuration/context/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Context
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configuration/agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agents
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configuration/tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configuration/reports/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Reports
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configuration/coordinators/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Coordinator
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configuration/embeddings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Embeddings
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configuration/vector_stores/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Vector Stores
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_14" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../configuration/spec/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Specs
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_14" id="__nav_7_14_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_14">
            <span class="md-nav__icon md-icon"></span>
            
  
    Specs
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configuration/spec/concepts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Core Concepts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configuration/spec/sources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Loading Data
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configuration/spec/pipelines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Transforming Data
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configuration/spec/views/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Visualizing Data
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configuration/spec/variables/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Variables & References
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configuration/spec/customization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Custom Components
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configuration/spec/python-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Python API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configuration/spec/downloads/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Downloads
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configuration/spec/authentication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Authentication
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configuration/spec/deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deployment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_1" >
        
          
          <label class="md-nav__link" for="__nav_8_1" id="__nav_8_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    API
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    API
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_1_1" >
        
          
          <label class="md-nav__link" for="__nav_8_1_1" id="__nav_8_1_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    AI
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_8_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_1_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    AI
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/api/ai/agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agents
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/api/ai/coordinator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Coordinator
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/api/ai/models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Models
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/api/ai/tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/api/ai/core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Core
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/api/pipeline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Pipeline
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/api/sources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sources
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/api/transforms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Transforms
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/api/views/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Views
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#final-result" class="md-nav__link">
    <span class="md-ellipsis">
      
        Final result
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-youll-build" class="md-nav__link">
    <span class="md-ellipsis">
      
        What you'll build
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-custom-data-source-controls" class="md-nav__link">
    <span class="md-ellipsis">
      
        Why custom data source controls?
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prerequisites
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-minimal-runnable-example" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. Minimal runnable example
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-understanding-the-components" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Understanding the components
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Understanding the components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#custom-controls" class="md-nav__link">
    <span class="md-ellipsis">
      
        Custom controls
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ui-components" class="md-nav__link">
    <span class="md-ellipsis">
      
        UI components
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-fetching" class="md-nav__link">
    <span class="md-ellipsis">
      
        Data fetching
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#duckdb-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        DuckDB integration
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-extend-to-full-version" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Extend to full version
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#full-example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Full example
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      
        Next steps
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-also" class="md-nav__link">
    <span class="md-ellipsis">
      
        See also
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  
  
    <a href="https://github.com/holoviz/lumen/edit/main/docs/examples/tutorials/census_data_ai_explorer.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-file-pen" viewBox="0 0 24 24"><path d="M12.659 22H18a2 2 0 0 0 2-2V8a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 14 2H6a2 2 0 0 0-2 2v9.34"/><path d="M14 2v5a1 1 0 0 0 1 1h5M10.378 12.622a1 1 0 0 1 3 3.003L8.36 20.637a2 2 0 0 1-.854.506l-2.867.837a.5.5 0 0 1-.62-.62l.836-2.869a2 2 0 0 1 .506-.853z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/holoviz/lumen/raw/main/docs/examples/tutorials/census_data_ai_explorer.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-file-code-2" viewBox="0 0 24 24"><path d="M4 12.15V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.706.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2h-3.35"/><path d="M14 2v5a1 1 0 0 0 1 1h5M5 16l-3 3 3 3M9 22l3-3-3-3"/></svg>
    </a>
  


<h1 id="building-a-census-data-ai-explorer"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m15 19-6-2.11V5l6 2.11M20.5 3h-.16L15 5.1 9 3 3.36 4.9c-.21.07-.36.25-.36.48V20.5a.5.5 0 0 0 .5.5c.05 0 .11 0 .16-.03L9 18.9l6 2.1 5.64-1.9c.21-.1.36-.25.36-.48V3.5a.5.5 0 0 0-.5-.5"/></svg></span> Building a Census Data AI Explorer<a class="headerlink" href="#building-a-census-data-ai-explorer" title="Permanent link">&para;</a></h1>
<p><img alt="Census Data Explorer UI" src="../../../assets/tutorials/census_full.png" /></p>
<p>Build a data exploration application that integrates U.S. Census Bureau data using Lumen AI.</p>
<p>This tutorial creates a custom data source control that lets you fetch demographic data through a simple interface.</p>
<h2 id="final-result">Final result<a class="headerlink" href="#final-result" title="Permanent link">&para;</a></h2>
<p>A chat interface that can fetch and analyze U.S. Census data with custom controls for selecting datasets and years.</p>
<p><strong>Time</strong>: 15-20 minutes</p>
<h2 id="what-youll-build">What you'll build<a class="headerlink" href="#what-youll-build" title="Permanent link">&para;</a></h2>
<p>A custom data source control that integrates with the Census API and lets users explore demographic data through natural language queries. The tutorial follows three steps:</p>
<ol>
<li><strong>Start with a minimal example</strong> - Build a basic year selector with ~70 lines of runnable code</li>
<li><strong>Understand the components</strong> - Learn how each part works</li>
<li><strong>Extend to full version</strong> - Add dynamic options and more features</li>
</ol>
<p>Each step introduces key Lumen AI concepts for building custom data source integrations.</p>
<h2 id="why-custom-data-source-controls">Why custom data source controls?<a class="headerlink" href="#why-custom-data-source-controls" title="Permanent link">&para;</a></h2>
<p>Lumen AI ships with built-in support for common data sources like CSV files, DuckDB, and SQL databases. But what if your data lives behind an API that requires authentication, has complex query parameters, or needs real-time fetching?</p>
<p><strong>Custom data source controls</strong> let you (see <a href="../../../configuration/ui/#source-controls">Source Controls</a>):</p>
<ul>
<li><strong>Connect to external APIs</strong> - Fetch data from REST APIs, government data portals, or proprietary services</li>
<li><strong>Add interactive parameters</strong> - Let users select years, regions, variables, or filters before loading data</li>
<li><strong>Handle authentication</strong> - Manage API keys, OAuth tokens, or other credentials securely</li>
<li><strong>Transform on-the-fly</strong> - Process and clean data as it arrives</li>
<li><strong>Cache intelligently</strong> - Store expensive API responses to avoid redundant calls</li>
</ul>
<p>This tutorial uses the U.S. Census Bureau API as an example, but the same patterns apply to:</p>
<ul>
<li>Financial data APIs (Federal Reserve, Yahoo Finance)</li>
<li>Weather and climate data (NOAA, NASA)</li>
<li>Scientific datasets (genomics, astronomy, earth observation)</li>
<li>Internal corporate APIs and data warehouses</li>
</ul>
<p>Once you create a custom control, users can fetch data through a simple UI without writing code, then immediately ask natural language questions about it using Lumen AI's conversational interface.</p>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h2>
<p>Install the required packages:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>pip<span class="w"> </span>install<span class="w"> </span>lumen-ai<span class="w"> </span>censusdis
</span></code></pre></div>
<h2 id="1-minimal-runnable-example">1. Minimal runnable example<a class="headerlink" href="#1-minimal-runnable-example" title="Permanent link">&para;</a></h2>
<p><img alt="Census Data Explorer UI" src="../../../assets/tutorials/census_minimal.png" /></p>
<p>Copy this complete example to <code>census_explorer.py</code> and run it with <code>panel serve census_explorer.py --show</code>:</p>
<div class="language-py highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">census_explorer.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span>
<span class="normal"><a href="#__codelineno-1-19">19</a></span>
<span class="normal"><a href="#__codelineno-1-20">20</a></span>
<span class="normal"><a href="#__codelineno-1-21">21</a></span>
<span class="normal"><a href="#__codelineno-1-22">22</a></span>
<span class="normal"><a href="#__codelineno-1-23">23</a></span>
<span class="normal"><a href="#__codelineno-1-24">24</a></span>
<span class="normal"><a href="#__codelineno-1-25">25</a></span>
<span class="normal"><a href="#__codelineno-1-26">26</a></span>
<span class="normal"><a href="#__codelineno-1-27">27</a></span>
<span class="normal"><a href="#__codelineno-1-28">28</a></span>
<span class="normal"><a href="#__codelineno-1-29">29</a></span>
<span class="normal"><a href="#__codelineno-1-30">30</a></span>
<span class="normal"><a href="#__codelineno-1-31">31</a></span>
<span class="normal"><a href="#__codelineno-1-32">32</a></span>
<span class="normal"><a href="#__codelineno-1-33">33</a></span>
<span class="normal"><a href="#__codelineno-1-34">34</a></span>
<span class="normal"><a href="#__codelineno-1-35">35</a></span>
<span class="normal"><a href="#__codelineno-1-36">36</a></span>
<span class="normal"><a href="#__codelineno-1-37">37</a></span>
<span class="normal"><a href="#__codelineno-1-38">38</a></span>
<span class="normal"><a href="#__codelineno-1-39">39</a></span>
<span class="normal"><a href="#__codelineno-1-40">40</a></span>
<span class="normal"><a href="#__codelineno-1-41">41</a></span>
<span class="normal"><a href="#__codelineno-1-42">42</a></span>
<span class="normal"><a href="#__codelineno-1-43">43</a></span>
<span class="normal"><a href="#__codelineno-1-44">44</a></span>
<span class="normal"><a href="#__codelineno-1-45">45</a></span>
<span class="normal"><a href="#__codelineno-1-46">46</a></span>
<span class="normal"><a href="#__codelineno-1-47">47</a></span>
<span class="normal"><a href="#__codelineno-1-48">48</a></span>
<span class="normal"><a href="#__codelineno-1-49">49</a></span>
<span class="normal"><a href="#__codelineno-1-50">50</a></span>
<span class="normal"><a href="#__codelineno-1-51">51</a></span>
<span class="normal"><a href="#__codelineno-1-52">52</a></span>
<span class="normal"><a href="#__codelineno-1-53">53</a></span>
<span class="normal"><a href="#__codelineno-1-54">54</a></span>
<span class="normal"><a href="#__codelineno-1-55">55</a></span>
<span class="normal"><a href="#__codelineno-1-56">56</a></span>
<span class="normal"><a href="#__codelineno-1-57">57</a></span>
<span class="normal"><a href="#__codelineno-1-58">58</a></span>
<span class="normal"><a href="#__codelineno-1-59">59</a></span>
<span class="normal"><a href="#__codelineno-1-60">60</a></span>
<span class="normal"><a href="#__codelineno-1-61">61</a></span>
<span class="normal"><a href="#__codelineno-1-62">62</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">censusdis.data</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ced</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">panel</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pn</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">param</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">lumen.ai</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">lmai</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">lumen.ai.controls</span><span class="w"> </span><span class="kn">import</span> <span class="n">DownloadControls</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">lumen.sources.duckdb</span><span class="w"> </span><span class="kn">import</span> <span class="n">DuckDBSource</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">panel_material_ui</span><span class="w"> </span><span class="kn">import</span> <span class="n">Button</span><span class="p">,</span> <span class="n">IntSlider</span><span class="p">,</span> <span class="n">Column</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9"></a>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="n">pn</span><span class="o">.</span><span class="n">extension</span><span class="p">()</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11"></a>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12"></a>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="k">class</span><span class="w"> </span><span class="nc">CensusControls</span><span class="p">(</span><span class="n">DownloadControls</span><span class="p">):</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch U.S. Census population data.&quot;&quot;&quot;</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15"></a>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16"></a>    <span class="n">vintage</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">2023</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">2023</span><span class="p">),</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Year of data&quot;</span><span class="p">)</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17"></a>    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&lt;span class=&quot;material-icons&quot;&gt;assessment&lt;/span&gt; Census Data&#39;</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18"></a>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21"></a>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_year_select</span> <span class="o">=</span> <span class="n">IntSlider</span><span class="o">.</span><span class="n">from_param</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">vintage</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Year&quot;</span><span class="p">)</span>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_button</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Fetch Population Data&quot;</span><span class="p">,</span> <span class="n">on_click</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_fetch</span><span class="p">)</span>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_layout</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_year_select</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_button</span><span class="p">)</span>
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25"></a>
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_on_fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch census population data.&quot;&quot;&quot;</span>
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28"></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layout</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">loading</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29"></a>            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
</span><span id="__span-1-30"><a id="__codelineno-1-30" name="__codelineno-1-30"></a>            <span class="n">df</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">to_thread</span><span class="p">(</span>
</span><span id="__span-1-31"><a id="__codelineno-1-31" name="__codelineno-1-31"></a>                <span class="n">ced</span><span class="o">.</span><span class="n">download</span><span class="p">,</span>
</span><span id="__span-1-32"><a id="__codelineno-1-32" name="__codelineno-1-32"></a>                <span class="n">dataset</span><span class="o">=</span><span class="s2">&quot;acs/acs5&quot;</span><span class="p">,</span>  <span class="c1"># ACS 5-Year</span>
</span><span id="__span-1-33"><a id="__codelineno-1-33" name="__codelineno-1-33"></a>                <span class="n">vintage</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vintage</span><span class="p">,</span>
</span><span id="__span-1-34"><a id="__codelineno-1-34" name="__codelineno-1-34"></a>                <span class="n">download_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;NAME&quot;</span><span class="p">],</span>
</span><span id="__span-1-35"><a id="__codelineno-1-35" name="__codelineno-1-35"></a>                <span class="n">group</span><span class="o">=</span><span class="s2">&quot;B01003&quot;</span><span class="p">,</span>  <span class="c1"># Total population</span>
</span><span id="__span-1-36"><a id="__codelineno-1-36" name="__codelineno-1-36"></a>                <span class="n">state</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span>  <span class="c1"># All states</span>
</span><span id="__span-1-37"><a id="__codelineno-1-37" name="__codelineno-1-37"></a>            <span class="p">)</span>
</span><span id="__span-1-38"><a id="__codelineno-1-38" name="__codelineno-1-38"></a>            <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="__span-1-39"><a id="__codelineno-1-39" name="__codelineno-1-39"></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_table</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span><span id="__span-1-40"><a id="__codelineno-1-40" name="__codelineno-1-40"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="s2">&quot;upload_successful&quot;</span><span class="p">)</span>
</span><span id="__span-1-41"><a id="__codelineno-1-41" name="__codelineno-1-41"></a>
</span><span id="__span-1-42"><a id="__codelineno-1-42" name="__codelineno-1-42"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_add_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="__span-1-43"><a id="__codelineno-1-43" name="__codelineno-1-43"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Register DataFrame as a DuckDB source.&quot;&quot;&quot;</span>
</span><span id="__span-1-44"><a id="__codelineno-1-44" name="__codelineno-1-44"></a>        <span class="n">table_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;census_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vintage</span><span class="si">}</span><span class="s2">_population&quot;</span>
</span><span id="__span-1-45"><a id="__codelineno-1-45" name="__codelineno-1-45"></a>        <span class="n">source</span> <span class="o">=</span> <span class="n">DuckDBSource</span><span class="o">.</span><span class="n">from_df</span><span class="p">(</span><span class="n">tables</span><span class="o">=</span><span class="p">{</span><span class="n">table_name</span><span class="p">:</span> <span class="n">df</span><span class="p">})</span>
</span><span id="__span-1-46"><a id="__codelineno-1-46" name="__codelineno-1-46"></a>        <span class="n">source</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-1-47"><a id="__codelineno-1-47" name="__codelineno-1-47"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">source</span>
</span><span id="__span-1-48"><a id="__codelineno-1-48" name="__codelineno-1-48"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sources&quot;</span><span class="p">,</span> <span class="p">[])</span> <span class="o">+</span> <span class="p">[</span><span class="n">source</span><span class="p">]</span>
</span><span id="__span-1-49"><a id="__codelineno-1-49" name="__codelineno-1-49"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;table&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">table_name</span>
</span><span id="__span-1-50"><a id="__codelineno-1-50" name="__codelineno-1-50"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="s2">&quot;outputs&quot;</span><span class="p">)</span>
</span><span id="__span-1-51"><a id="__codelineno-1-51" name="__codelineno-1-51"></a>
</span><span id="__span-1-52"><a id="__codelineno-1-52" name="__codelineno-1-52"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">__panel__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-1-53"><a id="__codelineno-1-53" name="__codelineno-1-53"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layout</span>
</span><span id="__span-1-54"><a id="__codelineno-1-54" name="__codelineno-1-54"></a>
</span><span id="__span-1-55"><a id="__codelineno-1-55" name="__codelineno-1-55"></a>
</span><span id="__span-1-56"><a id="__codelineno-1-56" name="__codelineno-1-56"></a><span class="n">ui</span> <span class="o">=</span> <span class="n">lmai</span><span class="o">.</span><span class="n">ExplorerUI</span><span class="p">(</span>
</span><span id="__span-1-57"><a id="__codelineno-1-57" name="__codelineno-1-57"></a>    <span class="n">source_controls</span><span class="o">=</span><span class="p">[</span><span class="n">CensusControls</span><span class="p">],</span>
</span><span id="__span-1-58"><a id="__codelineno-1-58" name="__codelineno-1-58"></a>    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Census Data Explorer&quot;</span><span class="p">,</span>
</span><span id="__span-1-59"><a id="__codelineno-1-59" name="__codelineno-1-59"></a>    <span class="n">log_level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span>
</span><span id="__span-1-60"><a id="__codelineno-1-60" name="__codelineno-1-60"></a><span class="p">)</span>
</span><span id="__span-1-61"><a id="__codelineno-1-61" name="__codelineno-1-61"></a>
</span><span id="__span-1-62"><a id="__codelineno-1-62" name="__codelineno-1-62"></a><span class="n">ui</span><span class="o">.</span><span class="n">servable</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<p>This ~70 line example is immediately runnable! Try clicking on "Sources" in the sidebar, selecting the desired year, and clicking "Fetch Population Data".</p>
<p>Once the data loads, you can ask question like:</p>
<ul>
<li>"What is the total population?"</li>
<li>"Show me the top 10 states by population"</li>
<li>"Which state has the largest population?"</li>
</ul>
<h2 id="2-understanding-the-components">2. Understanding the components<a class="headerlink" href="#2-understanding-the-components" title="Permanent link">&para;</a></h2>
<p>Let's break down the key concepts:</p>
<h3 id="custom-controls">Custom controls<a class="headerlink" href="#custom-controls" title="Permanent link">&para;</a></h3>
<p><strong>Custom controls</strong> extend data sources by subclassing <code>lmai.controls.DownloadControls</code> (see <a href="../../../configuration/ui/#source-controls">Source Controls</a>):</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">CensusControls</span><span class="p">(</span><span class="n">DownloadControls</span><span class="p">):</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>    <span class="n">vintage</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">2023</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">2023</span><span class="p">),</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Year of data&quot;</span><span class="p">)</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&lt;span class=&quot;material-icons&quot;&gt;assessment&lt;/span&gt; Census Data&#39;</span>
</span></code></pre></div>
<p>The <code>bounds</code> parameter defines the valid range for the slider. The label appears in the sidebar with a Material Design icon.</p>
<h3 id="ui-components">UI components<a class="headerlink" href="#ui-components" title="Permanent link">&para;</a></h3>
<p><strong>IntSlider with from_param</strong> creates a bound widget directly from the parameter:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="bp">self</span><span class="o">.</span><span class="n">_year_select</span> <span class="o">=</span> <span class="n">IntSlider</span><span class="o">.</span><span class="n">from_param</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">vintage</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Year&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p>This automatically handles two-way binding between the widget and parameter.</p>
<p><strong>Inline button setup</strong> is more concise:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="bp">self</span><span class="o">.</span><span class="n">_fetch_button</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Fetch Population Data&quot;</span><span class="p">,</span> <span class="n">on_click</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_fetch</span><span class="p">)</span>
</span></code></pre></div>
<p><strong>Column layout</strong> arranges components vertically:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="bp">self</span><span class="o">.</span><span class="n">_layout</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_year_select</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_button</span><span class="p">)</span>
</span></code></pre></div>
<h3 id="data-fetching">Data fetching<a class="headerlink" href="#data-fetching" title="Permanent link">&para;</a></h3>
<p><strong>Loading indicator</strong> with context manager:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layout</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">loading</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>  <span class="c1"># Ensure UI updates</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>    <span class="n">df</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">to_thread</span><span class="p">(</span><span class="n">ced</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="o">...</span><span class="p">))</span>
</span></code></pre></div>
<p><strong>Don't block the main thread</strong> by using <code>asyncio.to_thread()</code>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">df</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">to_thread</span><span class="p">(</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>    <span class="n">ced</span><span class="o">.</span><span class="n">download</span><span class="p">,</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    <span class="n">dataset</span><span class="o">=</span><span class="s2">&quot;acs/acs5&quot;</span><span class="p">,</span>  <span class="c1"># ACS 5-Year dataset</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>    <span class="n">vintage</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vintage</span><span class="p">,</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>    <span class="n">download_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;NAME&quot;</span><span class="p">],</span>  <span class="c1"># Include place names</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>    <span class="n">group</span><span class="o">=</span><span class="s2">&quot;B01003&quot;</span><span class="p">,</span>  <span class="c1"># Total population variable group</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>    <span class="n">state</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span>  <span class="c1"># All states</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="p">)</span>
</span></code></pre></div>
<h3 id="duckdb-integration">DuckDB integration<a class="headerlink" href="#duckdb-integration" title="Permanent link">&para;</a></h3>
<p><strong>Simplified source creation</strong> with <code>from_df()</code>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">table_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;census_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">vintage</span><span class="si">}</span><span class="s2">_population&quot;</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="n">source</span> <span class="o">=</span> <span class="n">DuckDBSource</span><span class="o">.</span><span class="n">from_df</span><span class="p">(</span><span class="n">tables</span><span class="o">=</span><span class="p">{</span><span class="n">table_name</span><span class="p">:</span> <span class="n">df</span><span class="p">})</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="n">source</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="c1"># Make available to Lumen AI</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">source</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;table&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">table_name</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="s2">&quot;outputs&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p>Note the dynamic table name that includes the year for clarity.</p>
<h2 id="3-extend-to-full-version">3. Extend to full version<a class="headerlink" href="#3-extend-to-full-version" title="Permanent link">&para;</a></h2>
<p>The minimal example uses fixed values: ACS 5-Year dataset, population data (group B01003), state geography. The full example below adds nice-to-have features like progress bars and error messages, plus:</p>
<p><strong>Dynamic variable groups</strong> - Load and display all available Census variable groups:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">_get_group_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch variable groups and return {label: value} dict.&quot;&quot;&quot;</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>    <span class="n">cache_key</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vintage</span><span class="p">)</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>    <span class="k">if</span> <span class="n">cache_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_groups_cache</span><span class="p">:</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>        <span class="n">groups_df</span> <span class="o">=</span> <span class="n">ced</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">all_groups</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vintage</span><span class="p">)</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_groups_cache</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>            <span class="n">row</span><span class="p">[</span><span class="s2">&quot;GROUP&quot;</span><span class="p">]:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;DESCRIPTION&quot;</span><span class="p">]</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">groups_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>        <span class="p">}</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>    <span class="n">groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_groups_cache</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>    <span class="k">return</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">groups</span><span class="p">[</span><span class="n">code</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="n">code</span> <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
</span></code></pre></div>
<p><strong>Multiple datasets</strong> - Choose between ACS 1-Year and 5-Year:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">censusdis.datasets</span><span class="w"> </span><span class="kn">import</span> <span class="n">ACS1</span><span class="p">,</span> <span class="n">ACS5</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="n">dataset</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">ACS5</span><span class="p">,</span> <span class="n">objects</span><span class="o">=</span><span class="p">[</span><span class="n">ACS5</span><span class="p">,</span> <span class="n">ACS1</span><span class="p">])</span>
</span></code></pre></div>
<p><strong>Geography levels</strong> - Select state, county, tract, block group, etc.:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">censusdis.geography</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cgeo</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="k">def</span><span class="w"> </span><span class="nf">_get_geo_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch geographies and return {label: value} dict.&quot;&quot;&quot;</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>    <span class="n">geo_specs</span> <span class="o">=</span> <span class="n">cgeo</span><span class="o">.</span><span class="n">geo_path_snake_specs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vintage</span><span class="p">)</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>    <span class="c1"># Return unique leaf geographies with friendly names</span>
</span></code></pre></div>
<p><strong>State filtering</strong> - Limit data to specific states:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">censusdis.states</span><span class="w"> </span><span class="kn">import</span> <span class="n">NAMES_FROM_IDS</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="n">STATES</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;All States&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">fips</span> <span class="k">for</span> <span class="n">fips</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">NAMES_FROM_IDS</span><span class="o">.</span><span class="n">items</span><span class="p">()}}</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="n">state_filter</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;All States&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p><strong>Reactive updates</strong> - Options update when dataset/year changes:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="nd">@param</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s2">&quot;dataset&quot;</span><span class="p">,</span> <span class="s2">&quot;vintage&quot;</span><span class="p">,</span> <span class="n">watch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">_on_dataset_vintage_change</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Update group and geo options when dataset or vintage changes.&quot;&quot;&quot;</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_group_select</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_group_options</span><span class="p">()</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_geo_select</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_geo_options</span><span class="p">()</span>
</span></code></pre></div>
<h2 id="full-example">Full example<a class="headerlink" href="#full-example" title="Permanent link">&para;</a></h2>
<p>Here's a complete implementation with all the features described above:</p>
<div class="language-py highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">census_explorer_full.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">  1</a></span>
<span class="normal"><a href="#__codelineno-14-2">  2</a></span>
<span class="normal"><a href="#__codelineno-14-3">  3</a></span>
<span class="normal"><a href="#__codelineno-14-4">  4</a></span>
<span class="normal"><a href="#__codelineno-14-5">  5</a></span>
<span class="normal"><a href="#__codelineno-14-6">  6</a></span>
<span class="normal"><a href="#__codelineno-14-7">  7</a></span>
<span class="normal"><a href="#__codelineno-14-8">  8</a></span>
<span class="normal"><a href="#__codelineno-14-9">  9</a></span>
<span class="normal"><a href="#__codelineno-14-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-14-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-14-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-14-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-14-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-14-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-14-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-14-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-14-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-14-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-14-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-14-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-14-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-14-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-14-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-14-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-14-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-14-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-14-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-14-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-14-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-14-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-14-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-14-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-14-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-14-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-14-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-14-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-14-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-14-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-14-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-14-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-14-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-14-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-14-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-14-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-14-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-14-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-14-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-14-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-14-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-14-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-14-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-14-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-14-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-14-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-14-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-14-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-14-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-14-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-14-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-14-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-14-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-14-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-14-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-14-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-14-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-14-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-14-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-14-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-14-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-14-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-14-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-14-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-14-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-14-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-14-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-14-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-14-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-14-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-14-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-14-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-14-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-14-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-14-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-14-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-14-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-14-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-14-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-14-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-14-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-14-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-14-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-14-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-14-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-14-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-14-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-14-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-14-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-14-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-14-100">100</a></span>
<span class="normal"><a href="#__codelineno-14-101">101</a></span>
<span class="normal"><a href="#__codelineno-14-102">102</a></span>
<span class="normal"><a href="#__codelineno-14-103">103</a></span>
<span class="normal"><a href="#__codelineno-14-104">104</a></span>
<span class="normal"><a href="#__codelineno-14-105">105</a></span>
<span class="normal"><a href="#__codelineno-14-106">106</a></span>
<span class="normal"><a href="#__codelineno-14-107">107</a></span>
<span class="normal"><a href="#__codelineno-14-108">108</a></span>
<span class="normal"><a href="#__codelineno-14-109">109</a></span>
<span class="normal"><a href="#__codelineno-14-110">110</a></span>
<span class="normal"><a href="#__codelineno-14-111">111</a></span>
<span class="normal"><a href="#__codelineno-14-112">112</a></span>
<span class="normal"><a href="#__codelineno-14-113">113</a></span>
<span class="normal"><a href="#__codelineno-14-114">114</a></span>
<span class="normal"><a href="#__codelineno-14-115">115</a></span>
<span class="normal"><a href="#__codelineno-14-116">116</a></span>
<span class="normal"><a href="#__codelineno-14-117">117</a></span>
<span class="normal"><a href="#__codelineno-14-118">118</a></span>
<span class="normal"><a href="#__codelineno-14-119">119</a></span>
<span class="normal"><a href="#__codelineno-14-120">120</a></span>
<span class="normal"><a href="#__codelineno-14-121">121</a></span>
<span class="normal"><a href="#__codelineno-14-122">122</a></span>
<span class="normal"><a href="#__codelineno-14-123">123</a></span>
<span class="normal"><a href="#__codelineno-14-124">124</a></span>
<span class="normal"><a href="#__codelineno-14-125">125</a></span>
<span class="normal"><a href="#__codelineno-14-126">126</a></span>
<span class="normal"><a href="#__codelineno-14-127">127</a></span>
<span class="normal"><a href="#__codelineno-14-128">128</a></span>
<span class="normal"><a href="#__codelineno-14-129">129</a></span>
<span class="normal"><a href="#__codelineno-14-130">130</a></span>
<span class="normal"><a href="#__codelineno-14-131">131</a></span>
<span class="normal"><a href="#__codelineno-14-132">132</a></span>
<span class="normal"><a href="#__codelineno-14-133">133</a></span>
<span class="normal"><a href="#__codelineno-14-134">134</a></span>
<span class="normal"><a href="#__codelineno-14-135">135</a></span>
<span class="normal"><a href="#__codelineno-14-136">136</a></span>
<span class="normal"><a href="#__codelineno-14-137">137</a></span>
<span class="normal"><a href="#__codelineno-14-138">138</a></span>
<span class="normal"><a href="#__codelineno-14-139">139</a></span>
<span class="normal"><a href="#__codelineno-14-140">140</a></span>
<span class="normal"><a href="#__codelineno-14-141">141</a></span>
<span class="normal"><a href="#__codelineno-14-142">142</a></span>
<span class="normal"><a href="#__codelineno-14-143">143</a></span>
<span class="normal"><a href="#__codelineno-14-144">144</a></span>
<span class="normal"><a href="#__codelineno-14-145">145</a></span>
<span class="normal"><a href="#__codelineno-14-146">146</a></span>
<span class="normal"><a href="#__codelineno-14-147">147</a></span>
<span class="normal"><a href="#__codelineno-14-148">148</a></span>
<span class="normal"><a href="#__codelineno-14-149">149</a></span>
<span class="normal"><a href="#__codelineno-14-150">150</a></span>
<span class="normal"><a href="#__codelineno-14-151">151</a></span>
<span class="normal"><a href="#__codelineno-14-152">152</a></span>
<span class="normal"><a href="#__codelineno-14-153">153</a></span>
<span class="normal"><a href="#__codelineno-14-154">154</a></span>
<span class="normal"><a href="#__codelineno-14-155">155</a></span>
<span class="normal"><a href="#__codelineno-14-156">156</a></span>
<span class="normal"><a href="#__codelineno-14-157">157</a></span>
<span class="normal"><a href="#__codelineno-14-158">158</a></span>
<span class="normal"><a href="#__codelineno-14-159">159</a></span>
<span class="normal"><a href="#__codelineno-14-160">160</a></span>
<span class="normal"><a href="#__codelineno-14-161">161</a></span>
<span class="normal"><a href="#__codelineno-14-162">162</a></span>
<span class="normal"><a href="#__codelineno-14-163">163</a></span>
<span class="normal"><a href="#__codelineno-14-164">164</a></span>
<span class="normal"><a href="#__codelineno-14-165">165</a></span>
<span class="normal"><a href="#__codelineno-14-166">166</a></span>
<span class="normal"><a href="#__codelineno-14-167">167</a></span>
<span class="normal"><a href="#__codelineno-14-168">168</a></span>
<span class="normal"><a href="#__codelineno-14-169">169</a></span>
<span class="normal"><a href="#__codelineno-14-170">170</a></span>
<span class="normal"><a href="#__codelineno-14-171">171</a></span>
<span class="normal"><a href="#__codelineno-14-172">172</a></span>
<span class="normal"><a href="#__codelineno-14-173">173</a></span>
<span class="normal"><a href="#__codelineno-14-174">174</a></span>
<span class="normal"><a href="#__codelineno-14-175">175</a></span>
<span class="normal"><a href="#__codelineno-14-176">176</a></span>
<span class="normal"><a href="#__codelineno-14-177">177</a></span>
<span class="normal"><a href="#__codelineno-14-178">178</a></span>
<span class="normal"><a href="#__codelineno-14-179">179</a></span>
<span class="normal"><a href="#__codelineno-14-180">180</a></span>
<span class="normal"><a href="#__codelineno-14-181">181</a></span>
<span class="normal"><a href="#__codelineno-14-182">182</a></span>
<span class="normal"><a href="#__codelineno-14-183">183</a></span>
<span class="normal"><a href="#__codelineno-14-184">184</a></span>
<span class="normal"><a href="#__codelineno-14-185">185</a></span>
<span class="normal"><a href="#__codelineno-14-186">186</a></span>
<span class="normal"><a href="#__codelineno-14-187">187</a></span>
<span class="normal"><a href="#__codelineno-14-188">188</a></span>
<span class="normal"><a href="#__codelineno-14-189">189</a></span>
<span class="normal"><a href="#__codelineno-14-190">190</a></span>
<span class="normal"><a href="#__codelineno-14-191">191</a></span>
<span class="normal"><a href="#__codelineno-14-192">192</a></span>
<span class="normal"><a href="#__codelineno-14-193">193</a></span>
<span class="normal"><a href="#__codelineno-14-194">194</a></span>
<span class="normal"><a href="#__codelineno-14-195">195</a></span>
<span class="normal"><a href="#__codelineno-14-196">196</a></span>
<span class="normal"><a href="#__codelineno-14-197">197</a></span>
<span class="normal"><a href="#__codelineno-14-198">198</a></span>
<span class="normal"><a href="#__codelineno-14-199">199</a></span>
<span class="normal"><a href="#__codelineno-14-200">200</a></span>
<span class="normal"><a href="#__codelineno-14-201">201</a></span>
<span class="normal"><a href="#__codelineno-14-202">202</a></span>
<span class="normal"><a href="#__codelineno-14-203">203</a></span>
<span class="normal"><a href="#__codelineno-14-204">204</a></span>
<span class="normal"><a href="#__codelineno-14-205">205</a></span>
<span class="normal"><a href="#__codelineno-14-206">206</a></span>
<span class="normal"><a href="#__codelineno-14-207">207</a></span>
<span class="normal"><a href="#__codelineno-14-208">208</a></span>
<span class="normal"><a href="#__codelineno-14-209">209</a></span>
<span class="normal"><a href="#__codelineno-14-210">210</a></span>
<span class="normal"><a href="#__codelineno-14-211">211</a></span>
<span class="normal"><a href="#__codelineno-14-212">212</a></span>
<span class="normal"><a href="#__codelineno-14-213">213</a></span>
<span class="normal"><a href="#__codelineno-14-214">214</a></span>
<span class="normal"><a href="#__codelineno-14-215">215</a></span>
<span class="normal"><a href="#__codelineno-14-216">216</a></span>
<span class="normal"><a href="#__codelineno-14-217">217</a></span>
<span class="normal"><a href="#__codelineno-14-218">218</a></span>
<span class="normal"><a href="#__codelineno-14-219">219</a></span>
<span class="normal"><a href="#__codelineno-14-220">220</a></span>
<span class="normal"><a href="#__codelineno-14-221">221</a></span>
<span class="normal"><a href="#__codelineno-14-222">222</a></span>
<span class="normal"><a href="#__codelineno-14-223">223</a></span>
<span class="normal"><a href="#__codelineno-14-224">224</a></span>
<span class="normal"><a href="#__codelineno-14-225">225</a></span>
<span class="normal"><a href="#__codelineno-14-226">226</a></span>
<span class="normal"><a href="#__codelineno-14-227">227</a></span>
<span class="normal"><a href="#__codelineno-14-228">228</a></span>
<span class="normal"><a href="#__codelineno-14-229">229</a></span>
<span class="normal"><a href="#__codelineno-14-230">230</a></span>
<span class="normal"><a href="#__codelineno-14-231">231</a></span>
<span class="normal"><a href="#__codelineno-14-232">232</a></span>
<span class="normal"><a href="#__codelineno-14-233">233</a></span>
<span class="normal"><a href="#__codelineno-14-234">234</a></span>
<span class="normal"><a href="#__codelineno-14-235">235</a></span>
<span class="normal"><a href="#__codelineno-14-236">236</a></span>
<span class="normal"><a href="#__codelineno-14-237">237</a></span>
<span class="normal"><a href="#__codelineno-14-238">238</a></span>
<span class="normal"><a href="#__codelineno-14-239">239</a></span>
<span class="normal"><a href="#__codelineno-14-240">240</a></span>
<span class="normal"><a href="#__codelineno-14-241">241</a></span>
<span class="normal"><a href="#__codelineno-14-242">242</a></span>
<span class="normal"><a href="#__codelineno-14-243">243</a></span>
<span class="normal"><a href="#__codelineno-14-244">244</a></span>
<span class="normal"><a href="#__codelineno-14-245">245</a></span>
<span class="normal"><a href="#__codelineno-14-246">246</a></span>
<span class="normal"><a href="#__codelineno-14-247">247</a></span>
<span class="normal"><a href="#__codelineno-14-248">248</a></span>
<span class="normal"><a href="#__codelineno-14-249">249</a></span>
<span class="normal"><a href="#__codelineno-14-250">250</a></span>
<span class="normal"><a href="#__codelineno-14-251">251</a></span>
<span class="normal"><a href="#__codelineno-14-252">252</a></span>
<span class="normal"><a href="#__codelineno-14-253">253</a></span>
<span class="normal"><a href="#__codelineno-14-254">254</a></span>
<span class="normal"><a href="#__codelineno-14-255">255</a></span>
<span class="normal"><a href="#__codelineno-14-256">256</a></span>
<span class="normal"><a href="#__codelineno-14-257">257</a></span>
<span class="normal"><a href="#__codelineno-14-258">258</a></span>
<span class="normal"><a href="#__codelineno-14-259">259</a></span>
<span class="normal"><a href="#__codelineno-14-260">260</a></span>
<span class="normal"><a href="#__codelineno-14-261">261</a></span>
<span class="normal"><a href="#__codelineno-14-262">262</a></span>
<span class="normal"><a href="#__codelineno-14-263">263</a></span>
<span class="normal"><a href="#__codelineno-14-264">264</a></span>
<span class="normal"><a href="#__codelineno-14-265">265</a></span>
<span class="normal"><a href="#__codelineno-14-266">266</a></span>
<span class="normal"><a href="#__codelineno-14-267">267</a></span>
<span class="normal"><a href="#__codelineno-14-268">268</a></span>
<span class="normal"><a href="#__codelineno-14-269">269</a></span>
<span class="normal"><a href="#__codelineno-14-270">270</a></span>
<span class="normal"><a href="#__codelineno-14-271">271</a></span>
<span class="normal"><a href="#__codelineno-14-272">272</a></span>
<span class="normal"><a href="#__codelineno-14-273">273</a></span>
<span class="normal"><a href="#__codelineno-14-274">274</a></span>
<span class="normal"><a href="#__codelineno-14-275">275</a></span>
<span class="normal"><a href="#__codelineno-14-276">276</a></span>
<span class="normal"><a href="#__codelineno-14-277">277</a></span>
<span class="normal"><a href="#__codelineno-14-278">278</a></span>
<span class="normal"><a href="#__codelineno-14-279">279</a></span>
<span class="normal"><a href="#__codelineno-14-280">280</a></span>
<span class="normal"><a href="#__codelineno-14-281">281</a></span>
<span class="normal"><a href="#__codelineno-14-282">282</a></span>
<span class="normal"><a href="#__codelineno-14-283">283</a></span>
<span class="normal"><a href="#__codelineno-14-284">284</a></span>
<span class="normal"><a href="#__codelineno-14-285">285</a></span>
<span class="normal"><a href="#__codelineno-14-286">286</a></span>
<span class="normal"><a href="#__codelineno-14-287">287</a></span>
<span class="normal"><a href="#__codelineno-14-288">288</a></span>
<span class="normal"><a href="#__codelineno-14-289">289</a></span>
<span class="normal"><a href="#__codelineno-14-290">290</a></span>
<span class="normal"><a href="#__codelineno-14-291">291</a></span>
<span class="normal"><a href="#__codelineno-14-292">292</a></span>
<span class="normal"><a href="#__codelineno-14-293">293</a></span>
<span class="normal"><a href="#__codelineno-14-294">294</a></span>
<span class="normal"><a href="#__codelineno-14-295">295</a></span>
<span class="normal"><a href="#__codelineno-14-296">296</a></span>
<span class="normal"><a href="#__codelineno-14-297">297</a></span>
<span class="normal"><a href="#__codelineno-14-298">298</a></span>
<span class="normal"><a href="#__codelineno-14-299">299</a></span>
<span class="normal"><a href="#__codelineno-14-300">300</a></span>
<span class="normal"><a href="#__codelineno-14-301">301</a></span>
<span class="normal"><a href="#__codelineno-14-302">302</a></span>
<span class="normal"><a href="#__codelineno-14-303">303</a></span>
<span class="normal"><a href="#__codelineno-14-304">304</a></span>
<span class="normal"><a href="#__codelineno-14-305">305</a></span>
<span class="normal"><a href="#__codelineno-14-306">306</a></span>
<span class="normal"><a href="#__codelineno-14-307">307</a></span>
<span class="normal"><a href="#__codelineno-14-308">308</a></span>
<span class="normal"><a href="#__codelineno-14-309">309</a></span>
<span class="normal"><a href="#__codelineno-14-310">310</a></span>
<span class="normal"><a href="#__codelineno-14-311">311</a></span>
<span class="normal"><a href="#__codelineno-14-312">312</a></span>
<span class="normal"><a href="#__codelineno-14-313">313</a></span>
<span class="normal"><a href="#__codelineno-14-314">314</a></span>
<span class="normal"><a href="#__codelineno-14-315">315</a></span>
<span class="normal"><a href="#__codelineno-14-316">316</a></span>
<span class="normal"><a href="#__codelineno-14-317">317</a></span>
<span class="normal"><a href="#__codelineno-14-318">318</a></span>
<span class="normal"><a href="#__codelineno-14-319">319</a></span>
<span class="normal"><a href="#__codelineno-14-320">320</a></span>
<span class="normal"><a href="#__codelineno-14-321">321</a></span>
<span class="normal"><a href="#__codelineno-14-322">322</a></span>
<span class="normal"><a href="#__codelineno-14-323">323</a></span>
<span class="normal"><a href="#__codelineno-14-324">324</a></span>
<span class="normal"><a href="#__codelineno-14-325">325</a></span>
<span class="normal"><a href="#__codelineno-14-326">326</a></span>
<span class="normal"><a href="#__codelineno-14-327">327</a></span>
<span class="normal"><a href="#__codelineno-14-328">328</a></span>
<span class="normal"><a href="#__codelineno-14-329">329</a></span>
<span class="normal"><a href="#__codelineno-14-330">330</a></span>
<span class="normal"><a href="#__codelineno-14-331">331</a></span>
<span class="normal"><a href="#__codelineno-14-332">332</a></span>
<span class="normal"><a href="#__codelineno-14-333">333</a></span>
<span class="normal"><a href="#__codelineno-14-334">334</a></span>
<span class="normal"><a href="#__codelineno-14-335">335</a></span>
<span class="normal"><a href="#__codelineno-14-336">336</a></span>
<span class="normal"><a href="#__codelineno-14-337">337</a></span>
<span class="normal"><a href="#__codelineno-14-338">338</a></span>
<span class="normal"><a href="#__codelineno-14-339">339</a></span>
<span class="normal"><a href="#__codelineno-14-340">340</a></span>
<span class="normal"><a href="#__codelineno-14-341">341</a></span>
<span class="normal"><a href="#__codelineno-14-342">342</a></span>
<span class="normal"><a href="#__codelineno-14-343">343</a></span>
<span class="normal"><a href="#__codelineno-14-344">344</a></span>
<span class="normal"><a href="#__codelineno-14-345">345</a></span>
<span class="normal"><a href="#__codelineno-14-346">346</a></span>
<span class="normal"><a href="#__codelineno-14-347">347</a></span>
<span class="normal"><a href="#__codelineno-14-348">348</a></span>
<span class="normal"><a href="#__codelineno-14-349">349</a></span>
<span class="normal"><a href="#__codelineno-14-350">350</a></span>
<span class="normal"><a href="#__codelineno-14-351">351</a></span>
<span class="normal"><a href="#__codelineno-14-352">352</a></span>
<span class="normal"><a href="#__codelineno-14-353">353</a></span>
<span class="normal"><a href="#__codelineno-14-354">354</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="sd">Census Data Explorer - Full Example</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="sd">Complete implementation with dynamic options and features</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5"></a>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">censusdis.data</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ced</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">censusdis.geography</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cgeo</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">panel</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pn</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="kn">import</span><span class="w"> </span><span class="nn">param</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11"></a><span class="kn">import</span><span class="w"> </span><span class="nn">lumen.ai</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">lmai</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12"></a><span class="kn">from</span><span class="w"> </span><span class="nn">censusdis.datasets</span><span class="w"> </span><span class="kn">import</span> <span class="n">ACS1</span><span class="p">,</span> <span class="n">ACS5</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13"></a><span class="kn">from</span><span class="w"> </span><span class="nn">censusdis.states</span><span class="w"> </span><span class="kn">import</span> <span class="n">NAMES_FROM_IDS</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14"></a><span class="kn">from</span><span class="w"> </span><span class="nn">lumen.ai.controls</span><span class="w"> </span><span class="kn">import</span> <span class="n">DownloadControls</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15"></a><span class="kn">from</span><span class="w"> </span><span class="nn">lumen.sources.duckdb</span><span class="w"> </span><span class="kn">import</span> <span class="n">DuckDBSource</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16"></a><span class="kn">from</span><span class="w"> </span><span class="nn">lumen.util</span><span class="w"> </span><span class="kn">import</span> <span class="n">normalize_table_name</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17"></a><span class="kn">from</span><span class="w"> </span><span class="nn">panel_material_ui</span><span class="w"> </span><span class="kn">import</span> <span class="n">Button</span><span class="p">,</span> <span class="n">FlexBox</span><span class="p">,</span> <span class="n">Select</span><span class="p">,</span> <span class="n">TextInput</span><span class="p">,</span> <span class="n">Markdown</span>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18"></a>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19"></a><span class="n">pn</span><span class="o">.</span><span class="n">extension</span><span class="p">()</span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20"></a>
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21"></a><span class="c1"># State FIPS codes</span>
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22"></a><span class="n">STATES</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;All States&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">fips</span> <span class="k">for</span> <span class="n">fips</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">NAMES_FROM_IDS</span><span class="o">.</span><span class="n">items</span><span class="p">()}}</span>
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23"></a>
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24"></a><span class="c1"># Available years per dataset</span>
</span><span id="__span-14-25"><a id="__codelineno-14-25" name="__codelineno-14-25"></a><span class="n">DATASET_YEARS</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-14-26"><a id="__codelineno-14-26" name="__codelineno-14-26"></a>    <span class="n">ACS5</span><span class="p">:</span> <span class="p">[</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">2022</span><span class="p">,</span> <span class="mi">2021</span><span class="p">,</span> <span class="mi">2020</span><span class="p">,</span> <span class="mi">2019</span><span class="p">,</span> <span class="mi">2018</span><span class="p">,</span> <span class="mi">2017</span><span class="p">,</span> <span class="mi">2016</span><span class="p">,</span> <span class="mi">2015</span><span class="p">,</span> <span class="mi">2014</span><span class="p">,</span> <span class="mi">2013</span><span class="p">,</span> <span class="mi">2012</span><span class="p">,</span> <span class="mi">2011</span><span class="p">],</span>
</span><span id="__span-14-27"><a id="__codelineno-14-27" name="__codelineno-14-27"></a>    <span class="n">ACS1</span><span class="p">:</span> <span class="p">[</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">2022</span><span class="p">,</span> <span class="mi">2021</span><span class="p">,</span> <span class="mi">2019</span><span class="p">,</span> <span class="mi">2018</span><span class="p">,</span> <span class="mi">2017</span><span class="p">,</span> <span class="mi">2016</span><span class="p">,</span> <span class="mi">2015</span><span class="p">,</span> <span class="mi">2014</span><span class="p">,</span> <span class="mi">2013</span><span class="p">,</span> <span class="mi">2012</span><span class="p">,</span> <span class="mi">2011</span><span class="p">],</span>
</span><span id="__span-14-28"><a id="__codelineno-14-28" name="__codelineno-14-28"></a><span class="p">}</span>
</span><span id="__span-14-29"><a id="__codelineno-14-29" name="__codelineno-14-29"></a>
</span><span id="__span-14-30"><a id="__codelineno-14-30" name="__codelineno-14-30"></a><span class="k">class</span><span class="w"> </span><span class="nc">CensusControlsFull</span><span class="p">(</span><span class="n">DownloadControls</span><span class="p">):</span>
</span><span id="__span-14-31"><a id="__codelineno-14-31" name="__codelineno-14-31"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Full-featured Census data control with dynamic options.&quot;&quot;&quot;</span>
</span><span id="__span-14-32"><a id="__codelineno-14-32" name="__codelineno-14-32"></a>
</span><span id="__span-14-33"><a id="__codelineno-14-33" name="__codelineno-14-33"></a>    <span class="n">dataset</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">ACS5</span><span class="p">,</span> <span class="n">objects</span><span class="o">=</span><span class="p">[</span><span class="n">ACS5</span><span class="p">,</span> <span class="n">ACS1</span><span class="p">],</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Census dataset&quot;</span><span class="p">)</span>
</span><span id="__span-14-34"><a id="__codelineno-14-34" name="__codelineno-14-34"></a>    <span class="n">vintage</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">2023</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Year of data&quot;</span><span class="p">)</span>
</span><span id="__span-14-35"><a id="__codelineno-14-35" name="__codelineno-14-35"></a>    <span class="n">group</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;B01003&quot;</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Variable group code&quot;</span><span class="p">)</span>
</span><span id="__span-14-36"><a id="__codelineno-14-36" name="__codelineno-14-36"></a>    <span class="n">geography</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;state&quot;</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Geographic level&quot;</span><span class="p">)</span>
</span><span id="__span-14-37"><a id="__codelineno-14-37" name="__codelineno-14-37"></a>    <span class="n">state_filter</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;All States&quot;</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;State to filter by&quot;</span><span class="p">)</span>
</span><span id="__span-14-38"><a id="__codelineno-14-38" name="__codelineno-14-38"></a>    <span class="n">table_alias</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;census_data&quot;</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Table name in database&quot;</span><span class="p">)</span>
</span><span id="__span-14-39"><a id="__codelineno-14-39" name="__codelineno-14-39"></a>
</span><span id="__span-14-40"><a id="__codelineno-14-40" name="__codelineno-14-40"></a>    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&lt;span class=&quot;material-icons&quot;&gt;assessment&lt;/span&gt; Census Data&#39;</span>
</span><span id="__span-14-41"><a id="__codelineno-14-41" name="__codelineno-14-41"></a>
</span><span id="__span-14-42"><a id="__codelineno-14-42" name="__codelineno-14-42"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">):</span>
</span><span id="__span-14-43"><a id="__codelineno-14-43" name="__codelineno-14-43"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
</span><span id="__span-14-44"><a id="__codelineno-14-44" name="__codelineno-14-44"></a>
</span><span id="__span-14-45"><a id="__codelineno-14-45" name="__codelineno-14-45"></a>        <span class="c1"># Caches for API data</span>
</span><span id="__span-14-46"><a id="__codelineno-14-46" name="__codelineno-14-46"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_groups_cache</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-14-47"><a id="__codelineno-14-47" name="__codelineno-14-47"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_geo_cache</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-14-48"><a id="__codelineno-14-48" name="__codelineno-14-48"></a>
</span><span id="__span-14-49"><a id="__codelineno-14-49" name="__codelineno-14-49"></a>        <span class="c1"># Load initial options</span>
</span><span id="__span-14-50"><a id="__codelineno-14-50" name="__codelineno-14-50"></a>        <span class="n">group_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_group_options</span><span class="p">()</span>
</span><span id="__span-14-51"><a id="__codelineno-14-51" name="__codelineno-14-51"></a>        <span class="n">geo_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_geo_options</span><span class="p">()</span>
</span><span id="__span-14-52"><a id="__codelineno-14-52" name="__codelineno-14-52"></a>        <span class="n">year_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_year_options</span><span class="p">()</span>
</span><span id="__span-14-53"><a id="__codelineno-14-53" name="__codelineno-14-53"></a>
</span><span id="__span-14-54"><a id="__codelineno-14-54" name="__codelineno-14-54"></a>        <span class="c1"># Build UI</span>
</span><span id="__span-14-55"><a id="__codelineno-14-55" name="__codelineno-14-55"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_select</span> <span class="o">=</span> <span class="n">Select</span><span class="p">(</span>
</span><span id="__span-14-56"><a id="__codelineno-14-56" name="__codelineno-14-56"></a>            <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span>
</span><span id="__span-14-57"><a id="__codelineno-14-57" name="__codelineno-14-57"></a>            <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ACS 5-Year&quot;</span><span class="p">:</span> <span class="n">ACS5</span><span class="p">,</span> <span class="s2">&quot;ACS 1-Year&quot;</span><span class="p">:</span> <span class="n">ACS1</span><span class="p">},</span>
</span><span id="__span-14-58"><a id="__codelineno-14-58" name="__codelineno-14-58"></a>            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Dataset&quot;</span><span class="p">,</span>
</span><span id="__span-14-59"><a id="__codelineno-14-59" name="__codelineno-14-59"></a>            <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;stretch_width&quot;</span><span class="p">,</span>
</span><span id="__span-14-60"><a id="__codelineno-14-60" name="__codelineno-14-60"></a>        <span class="p">)</span>
</span><span id="__span-14-61"><a id="__codelineno-14-61" name="__codelineno-14-61"></a>
</span><span id="__span-14-62"><a id="__codelineno-14-62" name="__codelineno-14-62"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vintage_select</span> <span class="o">=</span> <span class="n">Select</span><span class="p">(</span>
</span><span id="__span-14-63"><a id="__codelineno-14-63" name="__codelineno-14-63"></a>            <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vintage</span><span class="p">,</span>
</span><span id="__span-14-64"><a id="__codelineno-14-64" name="__codelineno-14-64"></a>            <span class="n">options</span><span class="o">=</span><span class="n">year_options</span><span class="p">,</span>
</span><span id="__span-14-65"><a id="__codelineno-14-65" name="__codelineno-14-65"></a>            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Year&quot;</span><span class="p">,</span>
</span><span id="__span-14-66"><a id="__codelineno-14-66" name="__codelineno-14-66"></a>            <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;stretch_width&quot;</span><span class="p">,</span>
</span><span id="__span-14-67"><a id="__codelineno-14-67" name="__codelineno-14-67"></a>        <span class="p">)</span>
</span><span id="__span-14-68"><a id="__codelineno-14-68" name="__codelineno-14-68"></a>
</span><span id="__span-14-69"><a id="__codelineno-14-69" name="__codelineno-14-69"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_group_select</span> <span class="o">=</span> <span class="n">Select</span><span class="p">(</span>
</span><span id="__span-14-70"><a id="__codelineno-14-70" name="__codelineno-14-70"></a>            <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span>
</span><span id="__span-14-71"><a id="__codelineno-14-71" name="__codelineno-14-71"></a>            <span class="n">options</span><span class="o">=</span><span class="n">group_options</span><span class="p">,</span>
</span><span id="__span-14-72"><a id="__codelineno-14-72" name="__codelineno-14-72"></a>            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Variable Group&quot;</span><span class="p">,</span>
</span><span id="__span-14-73"><a id="__codelineno-14-73" name="__codelineno-14-73"></a>            <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;stretch_width&quot;</span><span class="p">,</span>
</span><span id="__span-14-74"><a id="__codelineno-14-74" name="__codelineno-14-74"></a>        <span class="p">)</span>
</span><span id="__span-14-75"><a id="__codelineno-14-75" name="__codelineno-14-75"></a>
</span><span id="__span-14-76"><a id="__codelineno-14-76" name="__codelineno-14-76"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_geo_select</span> <span class="o">=</span> <span class="n">Select</span><span class="p">(</span>
</span><span id="__span-14-77"><a id="__codelineno-14-77" name="__codelineno-14-77"></a>            <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geography</span><span class="p">,</span>
</span><span id="__span-14-78"><a id="__codelineno-14-78" name="__codelineno-14-78"></a>            <span class="n">options</span><span class="o">=</span><span class="n">geo_options</span><span class="p">,</span>
</span><span id="__span-14-79"><a id="__codelineno-14-79" name="__codelineno-14-79"></a>            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Geography&quot;</span><span class="p">,</span>
</span><span id="__span-14-80"><a id="__codelineno-14-80" name="__codelineno-14-80"></a>            <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;stretch_width&quot;</span><span class="p">,</span>
</span><span id="__span-14-81"><a id="__codelineno-14-81" name="__codelineno-14-81"></a>        <span class="p">)</span>
</span><span id="__span-14-82"><a id="__codelineno-14-82" name="__codelineno-14-82"></a>
</span><span id="__span-14-83"><a id="__codelineno-14-83" name="__codelineno-14-83"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_state_select</span> <span class="o">=</span> <span class="n">Select</span><span class="p">(</span>
</span><span id="__span-14-84"><a id="__codelineno-14-84" name="__codelineno-14-84"></a>            <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state_filter</span><span class="p">,</span>
</span><span id="__span-14-85"><a id="__codelineno-14-85" name="__codelineno-14-85"></a>            <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">STATES</span><span class="o">.</span><span class="n">keys</span><span class="p">()},</span>
</span><span id="__span-14-86"><a id="__codelineno-14-86" name="__codelineno-14-86"></a>            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;State Filter&quot;</span><span class="p">,</span>
</span><span id="__span-14-87"><a id="__codelineno-14-87" name="__codelineno-14-87"></a>            <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;stretch_width&quot;</span><span class="p">,</span>
</span><span id="__span-14-88"><a id="__codelineno-14-88" name="__codelineno-14-88"></a>        <span class="p">)</span>
</span><span id="__span-14-89"><a id="__codelineno-14-89" name="__codelineno-14-89"></a>
</span><span id="__span-14-90"><a id="__codelineno-14-90" name="__codelineno-14-90"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_alias_input</span> <span class="o">=</span> <span class="n">TextInput</span><span class="o">.</span><span class="n">from_param</span><span class="p">(</span>
</span><span id="__span-14-91"><a id="__codelineno-14-91" name="__codelineno-14-91"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">table_alias</span><span class="p">,</span>
</span><span id="__span-14-92"><a id="__codelineno-14-92" name="__codelineno-14-92"></a>            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Table Name&quot;</span><span class="p">,</span>
</span><span id="__span-14-93"><a id="__codelineno-14-93" name="__codelineno-14-93"></a>            <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;stretch_width&quot;</span><span class="p">,</span>
</span><span id="__span-14-94"><a id="__codelineno-14-94" name="__codelineno-14-94"></a>        <span class="p">)</span>
</span><span id="__span-14-95"><a id="__codelineno-14-95" name="__codelineno-14-95"></a>
</span><span id="__span-14-96"><a id="__codelineno-14-96" name="__codelineno-14-96"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_button</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span>
</span><span id="__span-14-97"><a id="__codelineno-14-97" name="__codelineno-14-97"></a>            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Fetch Census Data&quot;</span><span class="p">,</span>
</span><span id="__span-14-98"><a id="__codelineno-14-98" name="__codelineno-14-98"></a>            <span class="n">icon</span><span class="o">=</span><span class="s2">&quot;download&quot;</span><span class="p">,</span>
</span><span id="__span-14-99"><a id="__codelineno-14-99" name="__codelineno-14-99"></a>            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;primary&quot;</span><span class="p">,</span>
</span><span id="__span-14-100"><a id="__codelineno-14-100" name="__codelineno-14-100"></a>            <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;stretch_width&quot;</span><span class="p">,</span>
</span><span id="__span-14-101"><a id="__codelineno-14-101" name="__codelineno-14-101"></a>            <span class="n">height</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
</span><span id="__span-14-102"><a id="__codelineno-14-102" name="__codelineno-14-102"></a>        <span class="p">)</span>
</span><span id="__span-14-103"><a id="__codelineno-14-103" name="__codelineno-14-103"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_button</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_on_fetch</span><span class="p">)</span>
</span><span id="__span-14-104"><a id="__codelineno-14-104" name="__codelineno-14-104"></a>
</span><span id="__span-14-105"><a id="__codelineno-14-105" name="__codelineno-14-105"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_layout</span> <span class="o">=</span> <span class="n">FlexBox</span><span class="p">(</span>
</span><span id="__span-14-106"><a id="__codelineno-14-106" name="__codelineno-14-106"></a>            <span class="n">Markdown</span><span class="p">(</span><span class="s2">&quot;### Census Data&quot;</span><span class="p">),</span>
</span><span id="__span-14-107"><a id="__codelineno-14-107" name="__codelineno-14-107"></a>            <span class="n">FlexBox</span><span class="p">(</span>
</span><span id="__span-14-108"><a id="__codelineno-14-108" name="__codelineno-14-108"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_select</span><span class="p">,</span>
</span><span id="__span-14-109"><a id="__codelineno-14-109" name="__codelineno-14-109"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_vintage_select</span><span class="p">,</span>
</span><span id="__span-14-110"><a id="__codelineno-14-110" name="__codelineno-14-110"></a>                <span class="n">flex_direction</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="p">,</span>
</span><span id="__span-14-111"><a id="__codelineno-14-111" name="__codelineno-14-111"></a>                <span class="n">gap</span><span class="o">=</span><span class="s2">&quot;10px&quot;</span><span class="p">,</span>
</span><span id="__span-14-112"><a id="__codelineno-14-112" name="__codelineno-14-112"></a>                <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;stretch_width&quot;</span><span class="p">,</span>
</span><span id="__span-14-113"><a id="__codelineno-14-113" name="__codelineno-14-113"></a>            <span class="p">),</span>
</span><span id="__span-14-114"><a id="__codelineno-14-114" name="__codelineno-14-114"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_group_select</span><span class="p">,</span>
</span><span id="__span-14-115"><a id="__codelineno-14-115" name="__codelineno-14-115"></a>            <span class="n">FlexBox</span><span class="p">(</span>
</span><span id="__span-14-116"><a id="__codelineno-14-116" name="__codelineno-14-116"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_geo_select</span><span class="p">,</span>
</span><span id="__span-14-117"><a id="__codelineno-14-117" name="__codelineno-14-117"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_state_select</span><span class="p">,</span>
</span><span id="__span-14-118"><a id="__codelineno-14-118" name="__codelineno-14-118"></a>                <span class="n">flex_direction</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="p">,</span>
</span><span id="__span-14-119"><a id="__codelineno-14-119" name="__codelineno-14-119"></a>                <span class="n">gap</span><span class="o">=</span><span class="s2">&quot;10px&quot;</span><span class="p">,</span>
</span><span id="__span-14-120"><a id="__codelineno-14-120" name="__codelineno-14-120"></a>                <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;stretch_width&quot;</span><span class="p">,</span>
</span><span id="__span-14-121"><a id="__codelineno-14-121" name="__codelineno-14-121"></a>            <span class="p">),</span>
</span><span id="__span-14-122"><a id="__codelineno-14-122" name="__codelineno-14-122"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_alias_input</span><span class="p">,</span>
</span><span id="__span-14-123"><a id="__codelineno-14-123" name="__codelineno-14-123"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_button</span><span class="p">,</span>
</span><span id="__span-14-124"><a id="__codelineno-14-124" name="__codelineno-14-124"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_error_placeholder</span><span class="p">,</span>
</span><span id="__span-14-125"><a id="__codelineno-14-125" name="__codelineno-14-125"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_message_placeholder</span><span class="p">,</span>
</span><span id="__span-14-126"><a id="__codelineno-14-126" name="__codelineno-14-126"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_progress_bar</span><span class="p">,</span>
</span><span id="__span-14-127"><a id="__codelineno-14-127" name="__codelineno-14-127"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_progress_description</span><span class="p">,</span>
</span><span id="__span-14-128"><a id="__codelineno-14-128" name="__codelineno-14-128"></a>            <span class="n">flex_direction</span><span class="o">=</span><span class="s2">&quot;column&quot;</span><span class="p">,</span>
</span><span id="__span-14-129"><a id="__codelineno-14-129" name="__codelineno-14-129"></a>            <span class="n">gap</span><span class="o">=</span><span class="s2">&quot;10px&quot;</span><span class="p">,</span>
</span><span id="__span-14-130"><a id="__codelineno-14-130" name="__codelineno-14-130"></a>            <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;stretch_width&quot;</span><span class="p">,</span>
</span><span id="__span-14-131"><a id="__codelineno-14-131" name="__codelineno-14-131"></a>            <span class="n">margin</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
</span><span id="__span-14-132"><a id="__codelineno-14-132" name="__codelineno-14-132"></a>        <span class="p">)</span>
</span><span id="__span-14-133"><a id="__codelineno-14-133" name="__codelineno-14-133"></a>
</span><span id="__span-14-134"><a id="__codelineno-14-134" name="__codelineno-14-134"></a>        <span class="c1"># Link widgets to params</span>
</span><span id="__span-14-135"><a id="__codelineno-14-135" name="__codelineno-14-135"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dataset_select</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;dataset&#39;</span><span class="p">)</span>
</span><span id="__span-14-136"><a id="__codelineno-14-136" name="__codelineno-14-136"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vintage_select</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;vintage&#39;</span><span class="p">)</span>
</span><span id="__span-14-137"><a id="__codelineno-14-137" name="__codelineno-14-137"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_group_select</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;group&#39;</span><span class="p">)</span>
</span><span id="__span-14-138"><a id="__codelineno-14-138" name="__codelineno-14-138"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_geo_select</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;geography&#39;</span><span class="p">)</span>
</span><span id="__span-14-139"><a id="__codelineno-14-139" name="__codelineno-14-139"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_state_select</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;state_filter&#39;</span><span class="p">)</span>
</span><span id="__span-14-140"><a id="__codelineno-14-140" name="__codelineno-14-140"></a>
</span><span id="__span-14-141"><a id="__codelineno-14-141" name="__codelineno-14-141"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_year_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-14-142"><a id="__codelineno-14-142" name="__codelineno-14-142"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get available years for current dataset.&quot;&quot;&quot;</span>
</span><span id="__span-14-143"><a id="__codelineno-14-143" name="__codelineno-14-143"></a>        <span class="n">years</span> <span class="o">=</span> <span class="n">DATASET_YEARS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span> <span class="p">[</span><span class="mi">2023</span><span class="p">])</span>
</span><span id="__span-14-144"><a id="__codelineno-14-144" name="__codelineno-14-144"></a>        <span class="k">return</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">):</span> <span class="n">y</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">years</span><span class="p">}</span>
</span><span id="__span-14-145"><a id="__codelineno-14-145" name="__codelineno-14-145"></a>
</span><span id="__span-14-146"><a id="__codelineno-14-146" name="__codelineno-14-146"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_group_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-14-147"><a id="__codelineno-14-147" name="__codelineno-14-147"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch variable groups from Census API.&quot;&quot;&quot;</span>
</span><span id="__span-14-148"><a id="__codelineno-14-148" name="__codelineno-14-148"></a>        <span class="n">cache_key</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vintage</span><span class="p">)</span>
</span><span id="__span-14-149"><a id="__codelineno-14-149" name="__codelineno-14-149"></a>
</span><span id="__span-14-150"><a id="__codelineno-14-150" name="__codelineno-14-150"></a>        <span class="k">if</span> <span class="n">cache_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_groups_cache</span><span class="p">:</span>
</span><span id="__span-14-151"><a id="__codelineno-14-151" name="__codelineno-14-151"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-14-152"><a id="__codelineno-14-152" name="__codelineno-14-152"></a>                <span class="n">groups_df</span> <span class="o">=</span> <span class="n">ced</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">all_groups</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vintage</span><span class="p">)</span>
</span><span id="__span-14-153"><a id="__codelineno-14-153" name="__codelineno-14-153"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_groups_cache</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-14-154"><a id="__codelineno-14-154" name="__codelineno-14-154"></a>                    <span class="n">row</span><span class="p">[</span><span class="s2">&quot;GROUP&quot;</span><span class="p">]:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;DESCRIPTION&quot;</span><span class="p">]</span>
</span><span id="__span-14-155"><a id="__codelineno-14-155" name="__codelineno-14-155"></a>                    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">groups_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()</span>
</span><span id="__span-14-156"><a id="__codelineno-14-156" name="__codelineno-14-156"></a>                <span class="p">}</span>
</span><span id="__span-14-157"><a id="__codelineno-14-157" name="__codelineno-14-157"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-14-158"><a id="__codelineno-14-158" name="__codelineno-14-158"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load groups: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-14-159"><a id="__codelineno-14-159" name="__codelineno-14-159"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_groups_cache</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-14-160"><a id="__codelineno-14-160" name="__codelineno-14-160"></a>
</span><span id="__span-14-161"><a id="__codelineno-14-161" name="__codelineno-14-161"></a>        <span class="n">groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_groups_cache</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span>
</span><span id="__span-14-162"><a id="__codelineno-14-162" name="__codelineno-14-162"></a>
</span><span id="__span-14-163"><a id="__codelineno-14-163" name="__codelineno-14-163"></a>        <span class="c1"># Prioritize common groups</span>
</span><span id="__span-14-164"><a id="__codelineno-14-164" name="__codelineno-14-164"></a>        <span class="n">popular</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;B01003&quot;</span><span class="p">,</span> <span class="s2">&quot;B01001&quot;</span><span class="p">,</span> <span class="s2">&quot;B19013&quot;</span><span class="p">,</span> <span class="s2">&quot;B02001&quot;</span><span class="p">,</span> <span class="s2">&quot;B25001&quot;</span><span class="p">,</span> <span class="s2">&quot;B15003&quot;</span><span class="p">,</span> <span class="s2">&quot;B17001&quot;</span><span class="p">]</span>
</span><span id="__span-14-165"><a id="__codelineno-14-165" name="__codelineno-14-165"></a>        <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-14-166"><a id="__codelineno-14-166" name="__codelineno-14-166"></a>
</span><span id="__span-14-167"><a id="__codelineno-14-167" name="__codelineno-14-167"></a>        <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">popular</span><span class="p">:</span>
</span><span id="__span-14-168"><a id="__codelineno-14-168" name="__codelineno-14-168"></a>            <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
</span><span id="__span-14-169"><a id="__codelineno-14-169" name="__codelineno-14-169"></a>                <span class="n">options</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">groups</span><span class="p">[</span><span class="n">code</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">code</span>
</span><span id="__span-14-170"><a id="__codelineno-14-170" name="__codelineno-14-170"></a>
</span><span id="__span-14-171"><a id="__codelineno-14-171" name="__codelineno-14-171"></a>        <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">groups</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="__span-14-172"><a id="__codelineno-14-172" name="__codelineno-14-172"></a>            <span class="k">if</span> <span class="n">code</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">popular</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">:</span>
</span><span id="__span-14-173"><a id="__codelineno-14-173" name="__codelineno-14-173"></a>                <span class="n">options</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">groups</span><span class="p">[</span><span class="n">code</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">code</span>
</span><span id="__span-14-174"><a id="__codelineno-14-174" name="__codelineno-14-174"></a>
</span><span id="__span-14-175"><a id="__codelineno-14-175" name="__codelineno-14-175"></a>        <span class="k">return</span> <span class="n">options</span>
</span><span id="__span-14-176"><a id="__codelineno-14-176" name="__codelineno-14-176"></a>
</span><span id="__span-14-177"><a id="__codelineno-14-177" name="__codelineno-14-177"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_geo_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-14-178"><a id="__codelineno-14-178" name="__codelineno-14-178"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch geographies from Census API.&quot;&quot;&quot;</span>
</span><span id="__span-14-179"><a id="__codelineno-14-179" name="__codelineno-14-179"></a>        <span class="n">cache_key</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vintage</span><span class="p">)</span>
</span><span id="__span-14-180"><a id="__codelineno-14-180" name="__codelineno-14-180"></a>
</span><span id="__span-14-181"><a id="__codelineno-14-181" name="__codelineno-14-181"></a>        <span class="k">if</span> <span class="n">cache_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geo_cache</span><span class="p">:</span>
</span><span id="__span-14-182"><a id="__codelineno-14-182" name="__codelineno-14-182"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-14-183"><a id="__codelineno-14-183" name="__codelineno-14-183"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_geo_cache</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">cgeo</span><span class="o">.</span><span class="n">geo_path_snake_specs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vintage</span><span class="p">)</span>
</span><span id="__span-14-184"><a id="__codelineno-14-184" name="__codelineno-14-184"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-14-185"><a id="__codelineno-14-185" name="__codelineno-14-185"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load geographies: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-14-186"><a id="__codelineno-14-186" name="__codelineno-14-186"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_geo_cache</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-14-187"><a id="__codelineno-14-187" name="__codelineno-14-187"></a>
</span><span id="__span-14-188"><a id="__codelineno-14-188" name="__codelineno-14-188"></a>        <span class="n">geo_specs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geo_cache</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span>
</span><span id="__span-14-189"><a id="__codelineno-14-189" name="__codelineno-14-189"></a>
</span><span id="__span-14-190"><a id="__codelineno-14-190" name="__codelineno-14-190"></a>        <span class="n">friendly_names</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-14-191"><a id="__codelineno-14-191" name="__codelineno-14-191"></a>            <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="s2">&quot;State&quot;</span><span class="p">,</span>
</span><span id="__span-14-192"><a id="__codelineno-14-192" name="__codelineno-14-192"></a>            <span class="s2">&quot;county&quot;</span><span class="p">:</span> <span class="s2">&quot;County&quot;</span><span class="p">,</span>
</span><span id="__span-14-193"><a id="__codelineno-14-193" name="__codelineno-14-193"></a>            <span class="s2">&quot;tract&quot;</span><span class="p">:</span> <span class="s2">&quot;Census Tract&quot;</span><span class="p">,</span>
</span><span id="__span-14-194"><a id="__codelineno-14-194" name="__codelineno-14-194"></a>            <span class="s2">&quot;block_group&quot;</span><span class="p">:</span> <span class="s2">&quot;Block Group&quot;</span><span class="p">,</span>
</span><span id="__span-14-195"><a id="__codelineno-14-195" name="__codelineno-14-195"></a>            <span class="s2">&quot;place&quot;</span><span class="p">:</span> <span class="s2">&quot;Place (City/Town)&quot;</span><span class="p">,</span>
</span><span id="__span-14-196"><a id="__codelineno-14-196" name="__codelineno-14-196"></a>            <span class="s2">&quot;county_subdivision&quot;</span><span class="p">:</span> <span class="s2">&quot;County Subdivision&quot;</span><span class="p">,</span>
</span><span id="__span-14-197"><a id="__codelineno-14-197" name="__codelineno-14-197"></a>            <span class="s2">&quot;us&quot;</span><span class="p">:</span> <span class="s2">&quot;United States (National)&quot;</span><span class="p">,</span>
</span><span id="__span-14-198"><a id="__codelineno-14-198" name="__codelineno-14-198"></a>            <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;Region&quot;</span><span class="p">,</span>
</span><span id="__span-14-199"><a id="__codelineno-14-199" name="__codelineno-14-199"></a>            <span class="s2">&quot;division&quot;</span><span class="p">:</span> <span class="s2">&quot;Division&quot;</span><span class="p">,</span>
</span><span id="__span-14-200"><a id="__codelineno-14-200" name="__codelineno-14-200"></a>        <span class="p">}</span>
</span><span id="__span-14-201"><a id="__codelineno-14-201" name="__codelineno-14-201"></a>
</span><span id="__span-14-202"><a id="__codelineno-14-202" name="__codelineno-14-202"></a>        <span class="c1"># Get unique leaf geographies</span>
</span><span id="__span-14-203"><a id="__codelineno-14-203" name="__codelineno-14-203"></a>        <span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-14-204"><a id="__codelineno-14-204" name="__codelineno-14-204"></a>        <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="__span-14-205"><a id="__codelineno-14-205" name="__codelineno-14-205"></a>        <span class="k">for</span> <span class="n">hierarchy</span> <span class="ow">in</span> <span class="n">geo_specs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="__span-14-206"><a id="__codelineno-14-206" name="__codelineno-14-206"></a>            <span class="n">leaf</span> <span class="o">=</span> <span class="n">hierarchy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-14-207"><a id="__codelineno-14-207" name="__codelineno-14-207"></a>            <span class="k">if</span> <span class="n">leaf</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
</span><span id="__span-14-208"><a id="__codelineno-14-208" name="__codelineno-14-208"></a>                <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">leaf</span><span class="p">)</span>
</span><span id="__span-14-209"><a id="__codelineno-14-209" name="__codelineno-14-209"></a>                <span class="n">label</span> <span class="o">=</span> <span class="n">friendly_names</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">leaf</span><span class="p">,</span> <span class="n">leaf</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">())</span>
</span><span id="__span-14-210"><a id="__codelineno-14-210" name="__codelineno-14-210"></a>                <span class="n">options</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">leaf</span>
</span><span id="__span-14-211"><a id="__codelineno-14-211" name="__codelineno-14-211"></a>
</span><span id="__span-14-212"><a id="__codelineno-14-212" name="__codelineno-14-212"></a>        <span class="k">return</span> <span class="n">options</span>
</span><span id="__span-14-213"><a id="__codelineno-14-213" name="__codelineno-14-213"></a>
</span><span id="__span-14-214"><a id="__codelineno-14-214" name="__codelineno-14-214"></a>    <span class="nd">@param</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s2">&quot;dataset&quot;</span><span class="p">,</span> <span class="n">watch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-14-215"><a id="__codelineno-14-215" name="__codelineno-14-215"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_on_dataset_change</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-14-216"><a id="__codelineno-14-216" name="__codelineno-14-216"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update year options when dataset changes.&quot;&quot;&quot;</span>
</span><span id="__span-14-217"><a id="__codelineno-14-217" name="__codelineno-14-217"></a>        <span class="n">new_year_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_year_options</span><span class="p">()</span>
</span><span id="__span-14-218"><a id="__codelineno-14-218" name="__codelineno-14-218"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_vintage_select</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">new_year_options</span>
</span><span id="__span-14-219"><a id="__codelineno-14-219" name="__codelineno-14-219"></a>
</span><span id="__span-14-220"><a id="__codelineno-14-220" name="__codelineno-14-220"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">vintage</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_year_options</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="__span-14-221"><a id="__codelineno-14-221" name="__codelineno-14-221"></a>            <span class="n">first_year</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">new_year_options</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-14-222"><a id="__codelineno-14-222" name="__codelineno-14-222"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_vintage_select</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">first_year</span>
</span><span id="__span-14-223"><a id="__codelineno-14-223" name="__codelineno-14-223"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">vintage</span> <span class="o">=</span> <span class="n">first_year</span>
</span><span id="__span-14-224"><a id="__codelineno-14-224" name="__codelineno-14-224"></a>
</span><span id="__span-14-225"><a id="__codelineno-14-225" name="__codelineno-14-225"></a>    <span class="nd">@param</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s2">&quot;dataset&quot;</span><span class="p">,</span> <span class="s2">&quot;vintage&quot;</span><span class="p">,</span> <span class="n">watch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-14-226"><a id="__codelineno-14-226" name="__codelineno-14-226"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_on_dataset_vintage_change</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-14-227"><a id="__codelineno-14-227" name="__codelineno-14-227"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Update group and geo options when dataset or vintage changes.&quot;&quot;&quot;</span>
</span><span id="__span-14-228"><a id="__codelineno-14-228" name="__codelineno-14-228"></a>        <span class="n">new_group_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_group_options</span><span class="p">()</span>
</span><span id="__span-14-229"><a id="__codelineno-14-229" name="__codelineno-14-229"></a>        <span class="n">current_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group</span>
</span><span id="__span-14-230"><a id="__codelineno-14-230" name="__codelineno-14-230"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_group_select</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">new_group_options</span>
</span><span id="__span-14-231"><a id="__codelineno-14-231" name="__codelineno-14-231"></a>        <span class="k">if</span> <span class="n">current_group</span> <span class="ow">in</span> <span class="n">new_group_options</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="__span-14-232"><a id="__codelineno-14-232" name="__codelineno-14-232"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_group_select</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">current_group</span>
</span><span id="__span-14-233"><a id="__codelineno-14-233" name="__codelineno-14-233"></a>        <span class="k">elif</span> <span class="n">new_group_options</span><span class="p">:</span>
</span><span id="__span-14-234"><a id="__codelineno-14-234" name="__codelineno-14-234"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_group_select</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">new_group_options</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-14-235"><a id="__codelineno-14-235" name="__codelineno-14-235"></a>
</span><span id="__span-14-236"><a id="__codelineno-14-236" name="__codelineno-14-236"></a>        <span class="n">new_geo_options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_geo_options</span><span class="p">()</span>
</span><span id="__span-14-237"><a id="__codelineno-14-237" name="__codelineno-14-237"></a>        <span class="n">current_geo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geography</span>
</span><span id="__span-14-238"><a id="__codelineno-14-238" name="__codelineno-14-238"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_geo_select</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">new_geo_options</span>
</span><span id="__span-14-239"><a id="__codelineno-14-239" name="__codelineno-14-239"></a>        <span class="k">if</span> <span class="n">current_geo</span> <span class="ow">in</span> <span class="n">new_geo_options</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="__span-14-240"><a id="__codelineno-14-240" name="__codelineno-14-240"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_geo_select</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">current_geo</span>
</span><span id="__span-14-241"><a id="__codelineno-14-241" name="__codelineno-14-241"></a>        <span class="k">elif</span> <span class="n">new_geo_options</span><span class="p">:</span>
</span><span id="__span-14-242"><a id="__codelineno-14-242" name="__codelineno-14-242"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_geo_select</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">new_geo_options</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-14-243"><a id="__codelineno-14-243" name="__codelineno-14-243"></a>
</span><span id="__span-14-244"><a id="__codelineno-14-244" name="__codelineno-14-244"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_build_geo_kwargs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-14-245"><a id="__codelineno-14-245" name="__codelineno-14-245"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Build geography kwargs for ced.download.&quot;&quot;&quot;</span>
</span><span id="__span-14-246"><a id="__codelineno-14-246" name="__codelineno-14-246"></a>        <span class="n">cache_key</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vintage</span><span class="p">)</span>
</span><span id="__span-14-247"><a id="__codelineno-14-247" name="__codelineno-14-247"></a>        <span class="n">geo_specs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geo_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cache_key</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="__span-14-248"><a id="__codelineno-14-248" name="__codelineno-14-248"></a>
</span><span id="__span-14-249"><a id="__codelineno-14-249" name="__codelineno-14-249"></a>        <span class="c1"># Find hierarchy ending with selected geography</span>
</span><span id="__span-14-250"><a id="__codelineno-14-250" name="__codelineno-14-250"></a>        <span class="n">target_geo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geography</span>
</span><span id="__span-14-251"><a id="__codelineno-14-251" name="__codelineno-14-251"></a>        <span class="n">hierarchy</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-14-252"><a id="__codelineno-14-252" name="__codelineno-14-252"></a>        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">geo_specs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="__span-14-253"><a id="__codelineno-14-253" name="__codelineno-14-253"></a>            <span class="k">if</span> <span class="n">h</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">target_geo</span><span class="p">:</span>
</span><span id="__span-14-254"><a id="__codelineno-14-254" name="__codelineno-14-254"></a>                <span class="n">hierarchy</span> <span class="o">=</span> <span class="n">h</span>
</span><span id="__span-14-255"><a id="__codelineno-14-255" name="__codelineno-14-255"></a>                <span class="k">break</span>
</span><span id="__span-14-256"><a id="__codelineno-14-256" name="__codelineno-14-256"></a>
</span><span id="__span-14-257"><a id="__codelineno-14-257" name="__codelineno-14-257"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">hierarchy</span><span class="p">:</span>
</span><span id="__span-14-258"><a id="__codelineno-14-258" name="__codelineno-14-258"></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">}</span>
</span><span id="__span-14-259"><a id="__codelineno-14-259" name="__codelineno-14-259"></a>
</span><span id="__span-14-260"><a id="__codelineno-14-260" name="__codelineno-14-260"></a>        <span class="c1"># Build kwargs</span>
</span><span id="__span-14-261"><a id="__codelineno-14-261" name="__codelineno-14-261"></a>        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-14-262"><a id="__codelineno-14-262" name="__codelineno-14-262"></a>        <span class="n">state_fips</span> <span class="o">=</span> <span class="n">STATES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_filter</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">)</span>
</span><span id="__span-14-263"><a id="__codelineno-14-263" name="__codelineno-14-263"></a>
</span><span id="__span-14-264"><a id="__codelineno-14-264" name="__codelineno-14-264"></a>        <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">hierarchy</span><span class="p">:</span>
</span><span id="__span-14-265"><a id="__codelineno-14-265" name="__codelineno-14-265"></a>            <span class="k">if</span> <span class="n">level</span> <span class="o">==</span> <span class="s2">&quot;state&quot;</span><span class="p">:</span>
</span><span id="__span-14-266"><a id="__codelineno-14-266" name="__codelineno-14-266"></a>                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">state_fips</span>
</span><span id="__span-14-267"><a id="__codelineno-14-267" name="__codelineno-14-267"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-14-268"><a id="__codelineno-14-268" name="__codelineno-14-268"></a>                <span class="n">kwargs</span><span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>
</span><span id="__span-14-269"><a id="__codelineno-14-269" name="__codelineno-14-269"></a>
</span><span id="__span-14-270"><a id="__codelineno-14-270" name="__codelineno-14-270"></a>        <span class="k">return</span> <span class="n">kwargs</span>
</span><span id="__span-14-271"><a id="__codelineno-14-271" name="__codelineno-14-271"></a>
</span><span id="__span-14-272"><a id="__codelineno-14-272" name="__codelineno-14-272"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_on_fetch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
</span><span id="__span-14-273"><a id="__codelineno-14-273" name="__codelineno-14-273"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch census data.&quot;&quot;&quot;</span>
</span><span id="__span-14-274"><a id="__codelineno-14-274" name="__codelineno-14-274"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">:</span>
</span><span id="__span-14-275"><a id="__codelineno-14-275" name="__codelineno-14-275"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_error_placeholder</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="s2">&quot; Please select a variable group&quot;</span>
</span><span id="__span-14-276"><a id="__codelineno-14-276" name="__codelineno-14-276"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_error_placeholder</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-14-277"><a id="__codelineno-14-277" name="__codelineno-14-277"></a>            <span class="k">return</span>
</span><span id="__span-14-278"><a id="__codelineno-14-278" name="__codelineno-14-278"></a>
</span><span id="__span-14-279"><a id="__codelineno-14-279" name="__codelineno-14-279"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_error_placeholder</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-14-280"><a id="__codelineno-14-280" name="__codelineno-14-280"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_message_placeholder</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-14-281"><a id="__codelineno-14-281" name="__codelineno-14-281"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_progress_bar</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-14-282"><a id="__codelineno-14-282" name="__codelineno-14-282"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_progress_bar</span><span class="o">.</span><span class="n">variant</span> <span class="o">=</span> <span class="s2">&quot;indeterminate&quot;</span>
</span><span id="__span-14-283"><a id="__codelineno-14-283" name="__codelineno-14-283"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_progress_description</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="s2">&quot;Fetching data...&quot;</span>
</span><span id="__span-14-284"><a id="__codelineno-14-284" name="__codelineno-14-284"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_progress_description</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-14-285"><a id="__codelineno-14-285" name="__codelineno-14-285"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_button</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-14-286"><a id="__codelineno-14-286" name="__codelineno-14-286"></a>
</span><span id="__span-14-287"><a id="__codelineno-14-287" name="__codelineno-14-287"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-14-288"><a id="__codelineno-14-288" name="__codelineno-14-288"></a>            <span class="n">geo_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_geo_kwargs</span><span class="p">()</span>
</span><span id="__span-14-289"><a id="__codelineno-14-289" name="__codelineno-14-289"></a>
</span><span id="__span-14-290"><a id="__codelineno-14-290" name="__codelineno-14-290"></a>            <span class="n">df</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">to_thread</span><span class="p">(</span>
</span><span id="__span-14-291"><a id="__codelineno-14-291" name="__codelineno-14-291"></a>                <span class="n">ced</span><span class="o">.</span><span class="n">download</span><span class="p">,</span>
</span><span id="__span-14-292"><a id="__codelineno-14-292" name="__codelineno-14-292"></a>                <span class="n">dataset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span>
</span><span id="__span-14-293"><a id="__codelineno-14-293" name="__codelineno-14-293"></a>                <span class="n">vintage</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vintage</span><span class="p">,</span>
</span><span id="__span-14-294"><a id="__codelineno-14-294" name="__codelineno-14-294"></a>                <span class="n">download_variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;NAME&quot;</span><span class="p">],</span>
</span><span id="__span-14-295"><a id="__codelineno-14-295" name="__codelineno-14-295"></a>                <span class="n">group</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span>
</span><span id="__span-14-296"><a id="__codelineno-14-296" name="__codelineno-14-296"></a>                <span class="o">**</span><span class="n">geo_kwargs</span><span class="p">,</span>
</span><span id="__span-14-297"><a id="__codelineno-14-297" name="__codelineno-14-297"></a>            <span class="p">)</span>
</span><span id="__span-14-298"><a id="__codelineno-14-298" name="__codelineno-14-298"></a>
</span><span id="__span-14-299"><a id="__codelineno-14-299" name="__codelineno-14-299"></a>            <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="__span-14-300"><a id="__codelineno-14-300" name="__codelineno-14-300"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_error_placeholder</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="s2">&quot; No data returned&quot;</span>
</span><span id="__span-14-301"><a id="__codelineno-14-301" name="__codelineno-14-301"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_error_placeholder</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-14-302"><a id="__codelineno-14-302" name="__codelineno-14-302"></a>                <span class="k">return</span>
</span><span id="__span-14-303"><a id="__codelineno-14-303" name="__codelineno-14-303"></a>
</span><span id="__span-14-304"><a id="__codelineno-14-304" name="__codelineno-14-304"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_table</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span><span id="__span-14-305"><a id="__codelineno-14-305" name="__codelineno-14-305"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_message_placeholder</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; Loaded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> rows into &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">table_alias</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
</span><span id="__span-14-306"><a id="__codelineno-14-306" name="__codelineno-14-306"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_message_placeholder</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-14-307"><a id="__codelineno-14-307" name="__codelineno-14-307"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="s2">&quot;upload_successful&quot;</span><span class="p">)</span>
</span><span id="__span-14-308"><a id="__codelineno-14-308" name="__codelineno-14-308"></a>
</span><span id="__span-14-309"><a id="__codelineno-14-309" name="__codelineno-14-309"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-14-310"><a id="__codelineno-14-310" name="__codelineno-14-310"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_error_placeholder</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-14-311"><a id="__codelineno-14-311" name="__codelineno-14-311"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_error_placeholder</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="__span-14-312"><a id="__codelineno-14-312" name="__codelineno-14-312"></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="__span-14-313"><a id="__codelineno-14-313" name="__codelineno-14-313"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_progress_bar</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-14-314"><a id="__codelineno-14-314" name="__codelineno-14-314"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_progress_description</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-14-315"><a id="__codelineno-14-315" name="__codelineno-14-315"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_button</span><span class="o">.</span><span class="n">disabled</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-14-316"><a id="__codelineno-14-316" name="__codelineno-14-316"></a>
</span><span id="__span-14-317"><a id="__codelineno-14-317" name="__codelineno-14-317"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_add_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
</span><span id="__span-14-318"><a id="__codelineno-14-318" name="__codelineno-14-318"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Register DataFrame as a DuckDB source.&quot;&quot;&quot;</span>
</span><span id="__span-14-319"><a id="__codelineno-14-319" name="__codelineno-14-319"></a>        <span class="n">table_name</span> <span class="o">=</span> <span class="n">normalize_table_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table_alias</span><span class="p">)</span>
</span><span id="__span-14-320"><a id="__codelineno-14-320" name="__codelineno-14-320"></a>        <span class="n">source</span> <span class="o">=</span> <span class="n">DuckDBSource</span><span class="o">.</span><span class="n">from_df</span><span class="p">(</span><span class="n">tables</span><span class="o">=</span><span class="p">{</span><span class="n">table_name</span><span class="p">:</span> <span class="n">df</span><span class="p">})</span>
</span><span id="__span-14-321"><a id="__codelineno-14-321" name="__codelineno-14-321"></a>        <span class="n">source</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-14-322"><a id="__codelineno-14-322" name="__codelineno-14-322"></a>
</span><span id="__span-14-323"><a id="__codelineno-14-323" name="__codelineno-14-323"></a>        <span class="n">source</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-14-324"><a id="__codelineno-14-324" name="__codelineno-14-324"></a>            <span class="n">table_name</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-14-325"><a id="__codelineno-14-325" name="__codelineno-14-325"></a>                <span class="s2">&quot;dataset&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">,</span>
</span><span id="__span-14-326"><a id="__codelineno-14-326" name="__codelineno-14-326"></a>                <span class="s2">&quot;vintage&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">vintage</span><span class="p">,</span>
</span><span id="__span-14-327"><a id="__codelineno-14-327" name="__codelineno-14-327"></a>                <span class="s2">&quot;group&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span>
</span><span id="__span-14-328"><a id="__codelineno-14-328" name="__codelineno-14-328"></a>                <span class="s2">&quot;geography&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">geography</span><span class="p">,</span>
</span><span id="__span-14-329"><a id="__codelineno-14-329" name="__codelineno-14-329"></a>            <span class="p">}</span>
</span><span id="__span-14-330"><a id="__codelineno-14-330" name="__codelineno-14-330"></a>        <span class="p">}</span>
</span><span id="__span-14-331"><a id="__codelineno-14-331" name="__codelineno-14-331"></a>
</span><span id="__span-14-332"><a id="__codelineno-14-332" name="__codelineno-14-332"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">source</span>
</span><span id="__span-14-333"><a id="__codelineno-14-333" name="__codelineno-14-333"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sources&quot;</span><span class="p">,</span> <span class="p">[])</span> <span class="o">+</span> <span class="p">[</span><span class="n">source</span><span class="p">]</span>
</span><span id="__span-14-334"><a id="__codelineno-14-334" name="__codelineno-14-334"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">[</span><span class="s2">&quot;table&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">table_name</span>
</span><span id="__span-14-335"><a id="__codelineno-14-335" name="__codelineno-14-335"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">trigger</span><span class="p">(</span><span class="s2">&quot;outputs&quot;</span><span class="p">)</span>
</span><span id="__span-14-336"><a id="__codelineno-14-336" name="__codelineno-14-336"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_last_table</span> <span class="o">=</span> <span class="n">table_name</span>
</span><span id="__span-14-337"><a id="__codelineno-14-337" name="__codelineno-14-337"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-14-338"><a id="__codelineno-14-338" name="__codelineno-14-338"></a>
</span><span id="__span-14-339"><a id="__codelineno-14-339" name="__codelineno-14-339"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">__panel__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-14-340"><a id="__codelineno-14-340" name="__codelineno-14-340"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_layout</span>
</span><span id="__span-14-341"><a id="__codelineno-14-341" name="__codelineno-14-341"></a>
</span><span id="__span-14-342"><a id="__codelineno-14-342" name="__codelineno-14-342"></a>
</span><span id="__span-14-343"><a id="__codelineno-14-343" name="__codelineno-14-343"></a><span class="n">ui</span> <span class="o">=</span> <span class="n">lmai</span><span class="o">.</span><span class="n">ExplorerUI</span><span class="p">(</span>
</span><span id="__span-14-344"><a id="__codelineno-14-344" name="__codelineno-14-344"></a>    <span class="n">source_controls</span><span class="o">=</span><span class="p">[</span><span class="n">CensusControlsFull</span><span class="p">],</span>
</span><span id="__span-14-345"><a id="__codelineno-14-345" name="__codelineno-14-345"></a>    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Census Data Explorer - Full&quot;</span><span class="p">,</span>
</span><span id="__span-14-346"><a id="__codelineno-14-346" name="__codelineno-14-346"></a>    <span class="n">suggestions</span><span class="o">=</span><span class="p">[</span>
</span><span id="__span-14-347"><a id="__codelineno-14-347" name="__codelineno-14-347"></a>        <span class="p">(</span><span class="s2">&quot;bar_chart&quot;</span><span class="p">,</span> <span class="s2">&quot;Show the top 10 states by population&quot;</span><span class="p">),</span>
</span><span id="__span-14-348"><a id="__codelineno-14-348" name="__codelineno-14-348"></a>        <span class="p">(</span><span class="s2">&quot;compare_arrows&quot;</span><span class="p">,</span> <span class="s2">&quot;Compare different demographic variables&quot;</span><span class="p">),</span>
</span><span id="__span-14-349"><a id="__codelineno-14-349" name="__codelineno-14-349"></a>        <span class="p">(</span><span class="s2">&quot;question_mark&quot;</span><span class="p">,</span> <span class="s2">&quot;What are the demographic patterns?&quot;</span><span class="p">),</span>
</span><span id="__span-14-350"><a id="__codelineno-14-350" name="__codelineno-14-350"></a>    <span class="p">],</span>
</span><span id="__span-14-351"><a id="__codelineno-14-351" name="__codelineno-14-351"></a>    <span class="n">log_level</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span>
</span><span id="__span-14-352"><a id="__codelineno-14-352" name="__codelineno-14-352"></a><span class="p">)</span>
</span><span id="__span-14-353"><a id="__codelineno-14-353" name="__codelineno-14-353"></a>
</span><span id="__span-14-354"><a id="__codelineno-14-354" name="__codelineno-14-354"></a><span class="n">ui</span><span class="o">.</span><span class="n">servable</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<p>This complete version includes all the features discussed: dynamic variable groups, multiple datasets, geography selection, state filtering, progress indicators, error handling, and reactive UI updates.</p>
<h2 id="next-steps">Next steps<a class="headerlink" href="#next-steps" title="Permanent link">&para;</a></h2>
<p>Extend this example by:</p>
<ul>
<li><strong>Add custom analyses</strong>: Create specialized visualizations for demographic data (see <a href="../../../configuration/analyses/">Analyses configuration</a>)</li>
<li><strong>Customize agents</strong>: Add domain expertise about Census variables and geography (see <a href="../../../configuration/agents/">Agents configuration</a>)</li>
<li><strong>Multiple sources</strong>: Combine Census data with other datasets for richer analysis (see <a href="../../../configuration/sources/">Sources configuration</a>)</li>
</ul>
<h2 id="see-also">See also<a class="headerlink" href="#see-also" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="../../../configuration/ui/#source-controls">Source Controls</a>  Complete guide to creating custom source controls</li>
<li><a href="../../../configuration/sources/">Data Sources</a>  File and database connections  </li>
<li><a href="../../../configuration/analyses/">Custom Analyses</a>  Building specialized visualizations</li>
</ul>














                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-circle-arrow-up" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="m16 12-4-4-4 4M12 16V8"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../saas_company_report_dashboard/" class="md-footer__link md-footer__link--prev" aria-label="Previous: SaaS Company Report Dashboard">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-arrow-left" viewBox="0 0 24 24"><path d="m12 19-7-7 7-7M19 12H5"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                SaaS Company Report Dashboard
              </div>
            </div>
          </a>
        
        
          
          <a href="../../gallery/" class="md-footer__link md-footer__link--next" aria-label="Next: Overview">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Overview
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="lucide lucide-arrow-right" viewBox="0 0 24 24"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://zensical.org/" target="_blank" rel="noopener">
      Zensical
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/holoviz/lumen" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://discourse.holoviz.org/c/lumen/" target="_blank" rel="noopener" title="discourse.holoviz.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M225.9 32C103.3 32 0 130.5 0 252.1 0 256 .1 480 .1 480l225.8-.2c122.7 0 222.1-102.3 222.1-223.9S348.6 32 225.9 32M224 384c-19.4 0-37.9-4.3-54.4-12.1L88.5 392l22.9-75c-9.8-18.1-15.4-38.9-15.4-61 0-70.7 57.3-128 128-128s128 57.3 128 128-57.3 128-128 128"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://discord.com/invite/rb6gPXbdAr" target="_blank" rel="noopener" title="discord.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/holoviz_org" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://pypi.org/project/lumen/" target="_blank" rel="noopener" title="pypi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 444.7a20.4 20.4 0 1 1 0-40.7 20.4 20.4 0 1 1 0 40.7M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.6-183.4a20.4 20.4 0 1 1 0 40.8 20.4 20.4 0 1 1 0-40.8"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      
      
      <script id="__config" type="application/json">{"annotate":null,"base":"../../..","features":["announce.dismiss","content.action.edit","content.action.view","content.code.annotate","content.code.copy","content.tooltips","navigation.footer","navigation.indexes","navigation.instant","navigation.instant.prefetch","navigation.instant.progress","navigation.sections","navigation.top","navigation.tracking","search.highlight","search.share","search.suggest","toc.follow"],"search":"../../../assets/javascripts/workers/search.e2d2d235.min.js","tags":null,"translations":{"clipboard.copied":"Copied to clipboard","clipboard.copy":"Copy to clipboard","search.result.more.one":"1 more on this page","search.result.more.other":"# more on this page","search.result.none":"No matching documents","search.result.one":"1 matching document","search.result.other":"# matching documents","search.result.placeholder":"Type to start searching","search.result.term.missing":"Missing","select.version":"Select version"},"version":null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.8ffeb9c9.min.js"></script>
      
        <script src="../../../assets/extra.js"></script>
      
    
  </body>
</html>